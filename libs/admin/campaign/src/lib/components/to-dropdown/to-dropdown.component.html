<div class="container">
  <ng-container
    *ngIf="
      search && searchList?.length;
      then searchDropdown;
      else subscriberListing
    "
  ></ng-container>
  <ng-template #subscriberListing>
    <div class="header">
      <div class="tab-group">
        <hospitality-bot-tab-group
          [listItems]="tabFilterItems"
          [selectedIndex]="tabFilterIdx"
          (selectedTabChange)="onSelectedTabFilterChange($event)"
        ></hospitality-bot-tab-group>
      </div>
      <div class="close">
        <mat-icon (click)="close($event)">cancel</mat-icon>
      </div>
    </div>
    <ng-container
      *ngIf="tabFilterIdx; then listing; else subscriberGroup"
    ></ng-container>
    <ng-template #subscriberGroup>
      <div class="sub-title">
        {{ 'toDrop.viewSubscriber' | translate }}
        <span class="color">{{ 'toDrop.customerPage' | translate }}</span>
      </div>
      <div class="listing">
        <div
          class="item-container"
          *ngFor="let group of subscribers | keyvalue"
          (click)="
            selectItem('SUBSCRIBER', {
              name: group.key,
              id: group.value[0]?.subsGroupId
            })
          "
        >
          <div>{{ group.key }}</div>
          <div class="data">
            {{ group.value.length }} {{ 'toDrop.guests' | translate }}
          </div>
        </div>
      </div>
      <div class="division"></div>
      <div class="info-message">
        {{ 'toDrop.infoMessage' | translate }}
        <span class="color">{{ 'toDrop.learn' | translate }}</span>
      </div>
    </ng-template>
    <ng-template #listing>
      <div class="sub-title">
        {{ 'toDrop.viewlist' | translate }}
        <span class="color" (click)="redirect('/pages/library/listing')">{{
          'toDrop.toDrop' | translate
        }}</span>
      </div>
      <div class="listing">
        <div
          class="item-container"
          *ngFor="let list of listings.data"
          (click)="selectItem('listing', list)"
        >
          <div>{{ list.name }}</div>
          <div class="data">
            {{ list.marketingContacts?.length }}
            {{ 'toDrop.guests' | translate }}
          </div>
        </div>
      </div>
      <div
        *ngIf="listings.totalRecords > listings.data.length"
        class="load-more"
        (click)="loadListings()"
      >
        {{ 'toDrop.show' | translate }}
      </div>
      <div class="division"></div>
      <div class="info-message">
        {{ 'toDrop.infoMessage' | translate }}
        <span class="color">{{ 'toDrop.learn' | translate }}</span>
      </div>
    </ng-template>
  </ng-template>
  <ng-template #searchDropdown>
    <div class="search-container">
      <div
        class="search-item"
        *ngFor="let item of searchList"
        (click)="selectItem(item.type, item)"
      >
        <ng-container *ngIf="item.type === 'email'; else noEmail">
          <div class="title">{{ item.name }}</div>
          <div class="description" *ngIf="item.firstName">
            <div class="margin">{{ item.firstName }} {{ item.lastName }}</div>
            <div class="margin">{{ item.email }}</div>
          </div>
        </ng-container>
        <ng-template #noEmail>
          <div class="listing">
            <div>{{ item.name }}</div>
            <div>{{ item.count }} Guests</div>
          </div>
        </ng-template>
      </div>
    </div>
  </ng-template>
</div>
