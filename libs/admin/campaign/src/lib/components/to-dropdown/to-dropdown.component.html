<div class="container">
  <ng-container
    *ngIf="search; then searchDropdown; else subscriberListing"
  ></ng-container>
  <ng-template #subscriberListing>
    <hospitality-bot-tab-group
      [listItems]="tabFilterItems"
      [selectedIndex]="tabFilterIdx"
      (selectedTabChange)="onSelectedTabFilterChange($event)"
    ></hospitality-bot-tab-group>
    <ng-container
      *ngIf="tabFilterIdx; then listing; else subscriberGroup"
    ></ng-container>
    <ng-template #subscriberGroup>
      <div class="sub-title">
        You can view all subscriber groups from the
        <span class="color">Customer Page</span>
      </div>
      <div class="listing">
        <div
          class="item-container"
          *ngFor="let group of subscribers | keyvalue"
          (click)="
            selectItem('SUBSCRIBER', {
              name: group.key,
              id: group.value[0]?.subsGroupId
            })
          "
        >
          <div>{{ group.key }}</div>
          <div class="data">{{ group.value.length }} Guests</div>
        </div>
      </div>
      <div class="division"></div>
      <div class="info-message">
        Email is sent to latest checked-out guests or you can specify the
        recipient in the group or individually please note email not sent to the
        guest who have already submitted the survey.
        <span class="color">Learn More</span>
      </div>
    </ng-template>
    <ng-template #listing>
      <div class="sub-title">
        You can create a new List from the
        <span class="color" (click)="redirect('/pages/library/listing')"
          >Listing Page</span
        >
      </div>
      <div class="listing">
        <div
          class="item-container"
          *ngFor="let list of listings.data"
          (click)="selectItem('listing', list)"
        >
          <div>{{ list.name }}</div>
          <div class="data">{{ list.marketingContacts?.length }} Guests</div>
        </div>
      </div>
      <div
        *ngIf="listings.totalRecords > listings.data.length"
        class="load-more"
        (click)="loadListings()"
      >
        Show More
      </div>
      <div class="division"></div>
      <div class="info-message">
        Email is sent to latest checked-out guests or you can specify the
        recipient in the group or individually please note email not sent to the
        guest who have already submitted the survey.
        <span class="color">Learn More</span>
      </div>
    </ng-template>
  </ng-template>
  <ng-template #searchDropdown>
    <div class="search-container">
      <div
        class="search-item"
        *ngFor="let item of searchList"
        (click)="selectItem(item.type, item)"
      >
        <ng-container *ngIf="item.type == 'email'; else noEmail">
          <div class="title">{{ item.name }}</div>
          <div class="description" *ngIf="item.firstName">
            <div class="margin">{{ item.firstName }} {{ item.lastName }}</div>
            <div class="margin">{{ item.email }}</div>
          </div>
        </ng-container>
        <ng-template #noEmail>
          <div class="listing">
            <div>{{ item.name }}</div>
            <div>{{ item.count }}</div>
          </div>
        </ng-template>
      </div>
    </div>
  </ng-template>
</div>
