<div
  class="action-header"
  [ngClass]="{ 'action-header__sticky': isScrolledUp }"
  [formGroup]="tableFG"
>
  <div class="heading">{{ tableName }}</div>
  <div class="action-wrapper">
    <hospitality-bot-export-list
      (onDocumentActions)="onDocumentActions()"
      [documentTypes]="documentTypes"
      [documentActionTypes]="documentActionTypes"
    ></hospitality-bot-export-list>
  </div>
</div>
<div [ngClass]="{ 'sticky-header-gap': isScrolledUp }"></div>

<p-table
  #dt
  [styleClass]="tableConfig.styleClass"
  [resizableColumns]="isResizableColumns"
  [autoLayout]="isAutoLayout"
  [loading]="loading"
  [columns]="cols"
  [value]="values"
  [paginator]="isPaginator"
  [rows]="rowsPerPage"
  [showCurrentPageReport]="showCurrentPageReport"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [(first)]="first"
  [totalRecords]="totalRecords"
  [filterDelay]="0"
  [selectionMode]="selectionMode"
  [(selection)]="selectedRows"
  (onRowSelect)="onRowSelect($event)"
  (onRowUnselect)="onRowUnselect($event)"
  (onHeaderCheckboxToggle)="onToggleSelectAll($event)"
  (sortFunction)="customSort($event)"
  [customSort]="isCustomSort"
  (onFilter)="onDataFilter()"
  *ngIf="!isEmpty; else emptyTable"
>
  <ng-template pTemplate="caption">
    <div class="caption__wrapper" [formGroup]="tableFG">
      <ng-container [ngTemplateOutlet]="tabFilter"> </ng-container>

      <hospitality-bot-filter-chips
        *ngIf="isQuickFilters"
        [chips]="filterChips"
        (onChange)="toggleQuickReplyFilter($event)"
        [selectedChips]="selectedFilterChips"
      ></hospitality-bot-filter-chips>
    </div>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr hospitality-bot-empty-view [noOfColumns]="cols.length"></tr>
  </ng-template>
  <!-- *******************************HEADER WITH SEARCH******************************* -->
  <ng-template pTemplate="header" let-columns>
    <tr
      hospitality-bot-table-header
      [columns]="columns"
      [showCheckbox]="isSelectable"
      (search)="handleFieldSearch($event)"
    ></tr>
  </ng-template>
  <!-- **************************************BODY********************************* -->
  <ng-template
    pTemplate="body"
    let-rowData
    let-columns="columns"
    let-rowIndex="rowIndex"
  >
    <tr class="table-row" (click)="openDetailPage($event, rowData)">
      <td class="table-row__checkbox">
        <p-tableCheckbox
          [value]="rowData"
          [index]="rowIndex"
          (click)="onCheckboxClicked($event)"
        ></p-tableCheckbox>
      </td>
      <td>
        <p class="tabel-room-no" [roomStatus]="rowData.rooms.status">
          {{ rowData.rooms.roomNumber || '--' }}&nbsp;-&nbsp;{{
            rowData.rooms.type || '--'
          }}
        </p>
      </td>
      <td>
        <p class="booking-number">{{ rowData.booking.bookingNumber }}</p>
        <!-- <div
          *ngIf="['COMPLETED'].includes(rowData.feedback.status)"
          class="booking-feedback"
          [ngClass]="
            rowData.feedback.rating < 5
              ? 'status-opacity-reject'
              : 'status-opacity-success'
          "
        >
          <p
            class="number"
            [ngClass]="
              rowData.feedback.rating < 5
                ? 'status-background-reject'
                : 'status-background-success'
            "
          >
            {{ rowData.feedback.rating }}
          </p>
          <div
            *ngIf="rowData.feedback.comments"
            [ngClass]="{
              'feedback-msg': rowData.feedback.comments.length > 0
            }"
          >
            {{ rowData.feedback.comments }}
          </div>
        </div> -->
      </td>
      <td class="multi-cell-content">
        <div class="primary-text">
          {{ rowData.guests.primaryGuest.getFullName() }}
        </div>
        <b class="rowData">{{
          rowData.guests.getSecGuestDisplayConfig().countString
        }}</b>
        <div
          *ngIf="rowData.guests.secondaryGuest.length > 0"
          [ngClass]="{ demo: rowData.guests.secondaryGuest.length > 0 }"
        >
          <div
            *ngFor="
              let secondaryGuest of rowData.guests.secondaryGuest;
              let guestIdx = index
            "
          >
            {{ secondaryGuest.fullName }}
          </div>
        </div>
      </td>
      <td class="package">
        <span
          *ngIf="
            rowData.guests.getPhoneNumbers().length &&
              rowData.guests.getPhoneNumbers() !== ' ';
            else emptyCell
          "
        >
          <ng-container
            *ngIf="
              rowData.guests.getPhoneNumbers().includes(',');
              else singlePhone
            "
          >
            <ng-container
              *ngFor="let link of rowData.guests.getPhoneNumbers().split(',\n')"
            >
              <a
                href="tel:{{ link }}"
                *ngIf="link"
                class="email"
                (click)="openDetailPage($event)"
              >
                <u> {{ link }}</u> </a
              ><br />
            </ng-container>
          </ng-container>
          <ng-template #singlePhone>
            <a
              href="tel:{{ rowData.guests.getPhoneNumbers() }}"
              class="email"
              (click)="openDetailPage($event)"
            >
              <u> {{ rowData.guests.getPhoneNumbers() }}</u>
            </a>
          </ng-template>
        </span>
      </td>
      <td>
        <p class="arrival-date">
          {{ rowData.booking.getArrivalDate(globalFilterService.timezone) }}-{{
            rowData.booking.getDepartureDate(globalFilterService.timezone)
          }}
        </p>

        <p class="arrival-time">
          {{ rowData.booking.getArrivalTime(globalFilterService.timezone) }}-{{
            rowData.booking.getDepartureTime(globalFilterService.timezone)
          }}
        </p>
        <p class="arrival-time">
          {{
            rowData.booking.getDaysAndNights(globalFilterService.timezone)
              .nights
          }}N |
          {{
            rowData.booking.getDaysAndNights(globalFilterService.timezone).days
          }}D
        </p>
      </td>
      <td class="amount">
        <span
          [ngClass]="{
            'status-text-reject':
              rowData.payment.dueAmount > 0 &&
              rowData.payment.dueAmount <= rowData.payment.totalAmount,
            'status-text-success': rowData.payment.dueAmount === 0
          }"
          >{{ rowData.payment.dueAmount | currency: 'INR' }}</span
        >/ {{ rowData.payment.totalAmount | currency: 'INR' }}
      </td>
      <!-- <td class="package">
        <span
          *ngIf="
            rowData.packages.getPaidPackagesLabels().length;
            else emptyCell
          "
          >{{ rowData.packages.getPaidPackagesLabels() }}
        </span>
      </td> -->

      <td class="status-image">
        <div class="icon-wrapper">
          <div class="line first"></div>
          <div class="line second"></div>
          <div
            (click)="openDetailPage($event, rowData, 'document_details')"
            class="icon"
          >
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.document.url"
              [alt]="dashboardConfig.images.document.alt"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.documents, 'image')
              "
            />
            <p
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.documents, 'text')
              "
            >
              {{ 'datatable.document' | translate }}
            </p>
            <div class="tooltip">
              {{ 'datatable.document' | translate }}
            </div>
          </div>
          <div
            (click)="openDetailPage($event, rowData, 'payment_details')"
            class="icon margin-left"
          >
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.payment.url"
              [alt]="dashboardConfig.images.payment.alt"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.payment, 'image')
              "
            />
            <p
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.payment, 'text')
              "
            >
              {{ 'datatable.payment' | translate }}
            </p>
            <div class="tooltip">
              {{ 'datatable.payment' | translate }}
            </div>
          </div>
          <!-- <div class="icon">
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.feedback.url"
              [alt]="dashboardConfig.images.feedback.alt"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.feedback, 'image')
              "
            />
            <p
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.stepsStatus.feedback, 'text')
              "
            >
              {{ 'datatable.feedback' | translate }}
            </p>
            <div class="tooltip">
              {{ 'datatable.feedback' | translate }}
            </div>
          </div> -->
          <!-- <div class="icon extra-width">
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.newJourney.url"
              [alt]="dashboardConfig.images.newJourney.alt"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.new, 'image')
              "
            />
            <p
              *ngIf="rowData.currentJourney.currentJourneyName === 'NEW'"
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.new, 'text')
              "
            ></p>
            <div class="tooltip">
              {{ 'datatable.new' | translate }}
            </div>
          </div> -->
          <div class="icon extra-width">
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.preCheckin.url"
              [alt]="dashboardConfig.images.preCheckin.alt"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.preCheckin, 'image')
              "
            />
            <p
              *ngIf="rowData.currentJourney.currentJourneyName === 'PRECHECKIN'"
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.preCheckin, 'text')
              "
            ></p>
            <div class="tooltip">
              {{ 'datatable.pre_checkin' | translate }}
            </div>
          </div>
          <div class="icon extra-width">
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.checkin.url"
              [alt]="dashboardConfig.images.checkin.alt"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.checkin, 'image')
              "
            />
            <p
              *ngIf="rowData.currentJourney.currentJourneyName === 'CHECKIN'"
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.checkin, 'text')
              "
            ></p>
            <div class="tooltip">
              {{ 'datatable.checkin' | translate }}
            </div>
          </div>
          <div class="icon extra-width">
            <img
              class="table-body-journey-icon"
              [src]="dashboardConfig.images.checkout.url"
              [alt]="dashboardConfig.images.checkout.alt"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.checkout, 'image')
              "
            />
            <p
              *ngIf="rowData.currentJourney.currentJourneyName === 'CHECKOUT'"
              class="label"
              [ngClass]="
                getStatusStyle(rowData.status.journeyStatus.checkout, 'text')
              "
            ></p>
            <div class="tooltip">
              {{ 'datatable.checkout' | translate }}
            </div>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <!-- *********************************FOOTER******************************* -->
  <ng-template pTemplate="summary">
    <p-paginator
      #paginator
      [rows]="rowsPerPage"
      [totalRecords]="totalRecords"
      [rowsPerPageOptions]="rowsPerPageOptions"
      (onPageChange)="paginate($event)"
      [currentPageReportTemplate]="reportTemplate"
      showCurrentPageReport="true"
    ></p-paginator>
  </ng-template>
</p-table>

<ng-template #emptyCell>
  <div class="emptyCell">&mdash;</div>
</ng-template>
<ng-template #emptyTable>
  <hospitality-bot-empty-table
    [isLoading]="loading"
    [content]="{
      description: 'No reservations found. ',
      imageSrc: 'assets/images/empty-table-in-house.png'
    }"
  >
    <ng-container [ngTemplateOutlet]="tabFilter"> </ng-container>
  </hospitality-bot-empty-table>
</ng-template>

<ng-template #tabFilter>
  <hospitality-bot-tab-group
    [selectedIndex]="tabFilterIdx"
    *ngIf="isTabFilters"
    [listItems]="tabFilterItems"
    (selectedTabChange)="onSelectedTabFilterChange($event)"
  >
    <div class="icon" (click)="isSidebarVisible = true">
      <i class="pi pi-arrow-left" style="color: white; font-weight: 600;"></i>

      <i class="pi pi-arrow-right" style="color: white; font-weight: 600;"></i>
    </div>
  </hospitality-bot-tab-group>
</ng-template>

<p-sidebar
  [visible]="isSidebarVisible"
  (onHide)="isSidebarVisible = false"
  class="sidebar"
  [showCloseIcon]="false"
  position="right"
  [style]="{ width: '23em' }"
>
  <div *ngIf="isSidebarVisible">
    <hospitality-bot-tabbed-sidebar
      [loading]="isPopUploading"
      [tabFilterItems]="popTabFilterItems"
      (selectedTabFilterChange)="onSelectedTab($event)"
      [options]="options"
      (onCloseSidebar)="isSidebarVisible = false"
      [template]="precard"
    >
    </hospitality-bot-tabbed-sidebar>
  </div>
</p-sidebar>

<ng-template #precard let-data>
  <div class="content pre-card">
    <div class="title">
      <span class="item-name">New Reservation</span>
    </div>
    <div class="name-section">
      <span class="name"
        >{{ data.guests.primaryGuest.fullName }},
        {{
          data.booking.expectedArrivalTimeStamp * 1000 | date: 'HH:mm a'
        }}</span
      >
      <span class="counts">
        <p>
          <svg
            width="12"
            height="18"
            viewBox="0 0 13 29"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.02938 4.84C7.3659 4.84 8.44938 3.75653 8.44938 2.42C8.44938 1.08347 7.3659 0 6.02938 0C4.69285 0 3.60938 1.08347 3.60938 2.42C3.60938 3.75653 4.69285 4.84 6.02938 4.84Z"
              fill="#001037"
            />
            <path
              d="M6.87161 5.99389C6.25994 5.87039 5.62902 5.87823 5.02061 6.01689C0.997611 6.48789 -0.30939 11.1449 0.0596104 14.6959C0.21961 16.2309 2.63961 16.2469 2.47761 14.6959C2.27955 13.1241 2.48999 11.5277 3.08861 10.0609V15.1219C3.08861 15.1819 3.09461 15.2369 3.09761 15.2949C3.09761 15.3219 3.08961 15.3449 3.08961 15.3729C3.08961 19.3889 3.08261 23.4029 2.91661 27.4159C2.84261 29.1999 5.60861 29.1929 5.68161 27.4159C5.81161 24.2709 5.84461 21.1239 5.85161 17.9769C5.98249 17.9849 6.11373 17.9849 6.24461 17.9769C6.25261 21.1239 6.28461 24.2709 6.41361 27.4149C6.48761 29.1919 9.25261 29.1989 9.17861 27.4149C9.01261 23.4019 9.00661 19.3879 9.00661 15.3719C9.00604 15.255 8.99194 15.1385 8.96461 15.0249C8.96461 13.2809 8.89461 11.5359 8.91461 9.79388C9.6325 11.3206 9.89498 13.0218 9.67061 14.6939C9.50861 16.2439 11.9286 16.2289 12.0886 14.6939C12.4686 11.0699 11.0986 6.29189 6.87161 5.99389Z"
              fill="#001037"
            />
          </svg>
          <span>{{ data.rooms.adultCount }}</span>
        </p>
        <p>
          <svg
            width="12"
            height="18"
            viewBox="0 0 12 21"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.9552 2.39718C10.8577 2.33168 10.7482 2.28603 10.6331 2.26284C10.518 2.23965 10.3994 2.23937 10.2841 2.26203C10.1689 2.28469 10.0592 2.32984 9.96142 2.3949C9.86363 2.45995 9.77962 2.54364 9.71418 2.64118L7.25318 6.30518C6.97378 6.16553 6.66554 6.09327 6.35318 6.09418H5.01217C4.70234 6.09374 4.39664 6.16529 4.11918 6.30319L1.66018 2.64118C1.52757 2.44439 1.32223 2.30834 1.08931 2.26296C0.856385 2.21757 0.614969 2.26657 0.418178 2.39918C0.221388 2.53179 0.0853425 2.73714 0.0399587 2.97006C-0.00542514 3.20298 0.0435656 3.44439 0.176174 3.64118L3.01619 7.87018C2.99519 8.04718 3.00418 19.7882 3.00418 19.7882C3.01287 20.0788 3.13442 20.3546 3.34304 20.557C3.55167 20.7595 3.83096 20.8728 4.12168 20.8728C4.41241 20.8728 4.69169 20.7595 4.90031 20.557C5.10893 20.3546 5.23048 20.0788 5.23918 19.7882V14.7552H6.13317V19.7842C6.1287 19.9338 6.1543 20.0827 6.20845 20.2222C6.26259 20.3617 6.34419 20.4889 6.44841 20.5963C6.55262 20.7036 6.67731 20.789 6.81512 20.8473C6.95293 20.9056 7.10105 20.9356 7.25068 20.9356C7.40031 20.9356 7.54842 20.9056 7.68623 20.8473C7.82404 20.789 7.94875 20.7036 8.05296 20.5963C8.15717 20.4889 8.23877 20.3617 8.29292 20.2222C8.34707 20.0827 8.37265 19.9338 8.36818 19.7842C8.36818 15.4652 8.37318 8.06519 8.35218 7.87319L11.1962 3.63719C11.3284 3.44073 11.3774 3.19982 11.3322 2.96733C11.287 2.73485 11.1514 2.5298 10.9552 2.39718Z"
              fill="#001037"
            />
            <path
              d="M5.68806 5.46927C6.1499 5.46921 6.59936 5.31988 6.96941 5.04355C7.33945 4.76721 7.61028 4.37868 7.7415 3.93587C7.87272 3.49307 7.85731 3.01971 7.69757 2.58638C7.53783 2.15304 7.24231 1.78295 6.85507 1.53127C6.98089 1.44726 7.11491 1.37623 7.25507 1.31927C7.29164 1.30549 7.32338 1.2813 7.34636 1.24968C7.36933 1.21806 7.38254 1.18041 7.38435 1.14136C7.38616 1.10232 7.37649 1.06361 7.35654 1.03C7.33658 0.996393 7.30721 0.969369 7.27206 0.952269C6.91334 0.793323 6.51197 0.758145 6.13107 0.852268C6.20317 0.71748 6.28895 0.590477 6.38707 0.473269C6.41294 0.443887 6.42961 0.40756 6.43503 0.368791C6.44044 0.330022 6.43436 0.290516 6.41754 0.255169C6.40072 0.219822 6.3739 0.190189 6.34039 0.169942C6.30689 0.149695 6.26818 0.139726 6.22906 0.141269C5.85438 0.206148 5.49915 0.354651 5.18977 0.575737C4.88039 0.796823 4.62483 1.0848 4.44208 1.41827C4.39195 1.50102 4.35072 1.58884 4.31908 1.68027C3.97952 1.96136 3.73495 2.34036 3.61874 2.76558C3.50253 3.19079 3.52034 3.6415 3.66974 4.05622C3.81913 4.47094 4.09283 4.82947 4.45351 5.08289C4.81418 5.33631 5.24427 5.47229 5.68507 5.47227L5.68806 5.46927Z"
              fill="#001037"
            />
          </svg>

          <span>{{ data.rooms.kidsCount }}</span>
        </p>
      </span>
    </div>
  </div>
</ng-template>
