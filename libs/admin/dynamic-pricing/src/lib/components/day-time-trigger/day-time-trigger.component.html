<div [formGroup]="dynamicPricingFG" *ngIf="!!dynamicPricingFG">
  <p-accordion class="accordion" [multiple]="true" #accordion>
    <div formArrayName="timeFA">
      <div
        [id]="fa.referenceId"
        *ngFor="
          let triggerFG of dynamicPricingControl.timeFA?.controls;
          let i = index
        "
        class="accordion-list"
      >
        <div [formGroupName]="i">
          <p-accordionTab [selected]="i == 0">
            <p-header>
              <div class="accordion-header">
                <div class="title item-center">
                  <div>
                    {{ triggerFG.get('name').value || 'Time Based Trigger' }}
                  </div>
                  <div class="date item-center">
                    <span *ngIf="triggerFG.get('fromDate').value; else empty">{{
                      triggerFG.get('fromDate').value | date: 'dd/MM/yyyy'
                    }}</span>
                    to
                    <span *ngIf="triggerFG.get('toDate').value; else empty">{{
                      triggerFG.get('toDate').value | date: 'dd/MM/yyyy'
                    }}</span>
                    <hospitality-bot-toggle-switch-with-label
                      class="toggle"
                      [isToggleOn]="triggerFG.get('status')?.value"
                      (onToggleSwitch)="triggerStatusChange($event, triggerFG)"
                      click-stop-propagation
                    ></hospitality-bot-toggle-switch-with-label>
                  </div>
                </div>
                <div class="status">
                  <hospitality-bot-button
                    click-stop-propagation
                    label="Remove"
                    variant="text"
                    severity="reset"
                    (onClick)="modifyTriggerFG('', i)"
                  ></hospitality-bot-button>
                </div>
              </div>
            </p-header>
            <div class="accordion-body">
              <div class="name-field">
                <hospitality-bot-input
                  class="full-width"
                  controlName="name"
                  maxLength="60"
                  label="Name"
                  [props]="{
                    placeholder: 'Enter Name'
                  }"
                ></hospitality-bot-input>
              </div>
              <div class="date-days-field">
                <hospitality-bot-from-to-date
                  [controlNames]="{
                    from: 'fromDate',
                    to: 'toDate'
                  }"
                ></hospitality-bot-from-to-date>
                <div class="days">
                  <hospitality-bot-checkbox-selector
                    class="bulk-update__week-days"
                    label="Days"
                    [allChecked]="triggerFG.get('type').value == 'add' && true"
                    [controlName]="'selectedDays'"
                    [options]="weeks"
                  >
                  </hospitality-bot-checkbox-selector>
                </div>
              </div>
            </div>
            <div
              class="level-datatable"
              formArrayName="hotelConfig"
              style="margin-top: 30px;"
            >
              <p-table>
                <ng-template pTemplate="header">
                  <tr>
                    <th style="width: 19%; padding-left: 30px;">From Time</th>
                    <th style="width: 17.5%; padding-left: 30px;">To Time</th>
                    <th style="width: 15%;">Start</th>
                    <th style="width: 5%;"></th>
                    <th style="width: 17.5%;">End</th>
                    <th style="width: 30%;">Discount/Markup</th>
                  </tr>
                </ng-template>
              </p-table>
              <ng-container
                *ngFor="
                  let levelFG of triggerFG?.get('hotelConfig')?.controls;
                  let j = index
                "
              >
                <div
                  [formGroupName]="j"
                  style="display: flex; padding: 23px 0;"
                >
                  <div
                    class="time-range-field"
                    style="width: 35%; padding: 0 18px 0 30px;"
                  >
                    <hospitality-bot-from-to-date
                      [controlNames]="{
                        from: 'fromTime',
                        to: 'toTime'
                      }"
                      [isTimeEnable]="true"
                      [isTimeOnly]="true"
                      [showIcon]="false"
                      [props]="{
                        showLabel: false,
                        preErrorMessages: {
                          required: 'This is required field',
                          collide: 'Trigger Conflict, choose different time.',
                          startError: 'From Time should be < To Time.',
                          timeGapError: 'At Least 1 Hrs Gap',
                          sameTime:
                            'Occupancy conflict, choose different range.'
                        },
                        postErrorMessages: {
                          required: 'This is required field',
                          min: 'To Time should be > From Time.',
                          collide: 'Trigger Conflict, choose different time',
                          endError: 'From Time should be < To Time.',
                          timeGapError: 'At Least 1 Hrs Gap',
                          sameTime:
                            'Occupancy conflict, choose different range.'
                        }
                      }"
                    ></hospitality-bot-from-to-date>
                  </div>
                  <div style="width: 35%; padding: 0 1rem;" class="no-margin">
                    <hospitality-bot-prefix-field
                      class="one-fourth-width"
                      preControlName="start"
                      postControlName="end"
                      preFieldType="input"
                      postFieldType="input"
                      [defaultProps]="{
                        pre: {
                          placeholder: 'Start',
                          type: 'number',
                          errorMessages: {
                            required: 'This is required field',
                            min: 'Minimum Value should be 1',
                            startError: 'Start should be <= End.',
                            collide: 'Collide, Fix it !',
                            sameTime:
                              'Occupancy conflict, choose different range.'
                          }
                        },
                        post: {
                          placeholder: 'End',
                          type: 'number',
                          errorMessages: {
                            required: 'This is required field',
                            min: 'Minimum Value should be 1',
                            endError: 'End should be >= Start.',
                            collide: 'Collide, Fix it !',
                            sameTime:
                              'Occupancy conflict, choose different range.'
                          }
                        }
                      }"
                      [settings]="{
                        layout: 'dashed',
                        dashHidden: true
                      }"
                    >
                    </hospitality-bot-prefix-field>
                  </div>
                  <div
                    style="
                      width: 30%;
                      padding: 0 30px 0 1rem;
                      display: flex;
                      align-items: center;
                      gap: 15px;
                    "
                  >
                    <div style="width: calc(100% - 35px);">
                      <hospitality-bot-input
                        class="full-width"
                        controlName="discount"
                        [props]="{
                          placeholder: 'Enter',
                          type: 'number'
                        }"
                      ></hospitality-bot-input>
                    </div>
                    <div
                      class="remove"
                      [ngClass]="
                        triggerFG.get('hotelConfig').controls.length < 2 &&
                        'disable'
                      "
                      (click)="
                        triggerFG.get('hotelConfig').controls.length > 1 &&
                          modifyLevelFG(triggerFG, '', j)
                      "
                    >
                      &#10006;
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
            <div class="add-level">
              <div class="link" (click)="modifyLevelFG(triggerFG)">
                +Add Level
              </div>
            </div>

            <!-- <div class="action">
              <hospitality-bot-button
                [disabled]="!isDirty(triggerFG)"
                [label]="
                  triggerFG.get('type').value === 'update' ? 'Update' : 'Save'
                "
                (click)="handleSave(triggerFG)"
              >
              </hospitality-bot-button>
            </div> -->

            <hospitality-bot-form-action
              [disabled]="!isDirty(triggerFG)"
              class="full-width"
              [config]="{
                preHide: true,
                postLabel:
                  triggerFG?.get('type')?.value === 'update' ? 'Update' : 'Save'
              }"
              (onPostAction)="handleSave(triggerFG)"
              #fa
            >
            </hospitality-bot-form-action>
          </p-accordionTab>
        </div>
      </div>
      <!-- <div class="add-trigger">
        <div class="link" (click)="modifyTriggerFG('add', null, true)">
          +Add New
        </div>
      </div> -->
    </div>
  </p-accordion>
</div>
<ng-template #empty>--/--/----</ng-template>
