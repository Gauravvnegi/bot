<div class="main-wrapper">
  <div class="header">
    <hospitality-bot-navigation-header
      heading="Dynamic Pricing"
      [routes]="[{ label: 'Revenue Manager', link: './' }]"
      [isStickyTitle]="false"
      [isBack]="false"
    >
      <hospitality-bot-button
        label="+ Create Season"
        [routerLink]="'create-season'"
        preserveQueryParams="true"
      ></hospitality-bot-button>
    </hospitality-bot-navigation-header>
  </div>

  <ng-container *ngIf="!loading; else loader">
    <hospitality-bot-empty-table
      *ngIf="!rulesFA.controls?.length"
      [isLoading]="loading"
      [link]="'create-season'"
      [content]="{
        description: 'No season created. Tap the Create Season to add season.',
        imageSrc: 'assets/images/empty-table-offer.png',
        actionName: '+ Create Season'
      }"
    >
    </hospitality-bot-empty-table>
    <div class="main" *ngIf="rulesFA.controls.length">
      <div class="calendar">
        <hospitality-bot-calendar-view
          [years]="years"
          calendarWidth="calc(90vw - 300px)"
          [gridData]="gridData"
          [highlightId]="highlightedRule"
          (onDateSelect)="onDateSelect($event)"
          [inactiveIds]="inactiveRules"
          (onDateHover)="handleHover($event)"
          [tooltip]="tooltip"
          [markDates]="markDates"
        ></hospitality-bot-calendar-view>
      </div>

      <div class="filters" id="season-filter" [formGroup]="useForm">
        <!-- <div class="filters__head">Seasons</div> -->
        <hospitality-bot-tab-group
          [listItems]="ruleOptions"
          [selectedIndex]="selectedRuleIdx"
          (selectedTabChange)="onRuleFilterChange($event)"
        ></hospitality-bot-tab-group>
        <div
          class="filters__main"
          *ngIf="useForm.get('seasons')?.length"
          formArrayName="seasons"
        >
          <ng-container
            *ngFor="
              let season of useForm.get('seasons')?.controls;
              let i = index
            "
          >
            <div
              *ngIf="season.get('type').value === selectedRuleType"
              [id]="season.get('id').value"
              class="season"
              [formGroupName]="i"
              [ngClass]="{
                season__selected: season.get('id').value === highlightedRule
              }"
              (click)="handleEdit(season.get('id').value)"
            >
              <div
                class="season__color"
                [ngStyle]="{
                  backgroundColor: season.get('colorCode').value
                }"
              ></div>
              <div class="season__name" [ngStyle]="{}">
                {{ season.get('name').value }}
              </div>

              <div class="season__toggle" click-stop-propagation>
                <hospitality-bot-input-switch
                  controlName="isActive"
                ></hospitality-bot-input-switch>
              </div>

              <div class="season__dates">
                <div class="season__date">
                  {{ season.get('fromDate').value | date: 'dd/MM/yyyy' }}
                </div>
                {{ ' - ' }}
                <div class="season__date">
                  {{ season.get('toDate').value | date: 'dd/MM/yyyy' }}
                </div>
              </div>

              <div class="season__days">
                <div
                  class="season__day"
                  *ngFor="let day of season.get('days').value"
                >
                  {{ day.label }}
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<ng-template #loader>
  <hospitality-bot-loader-bounce></hospitality-bot-loader-bounce>
</ng-template>
