<div
  *ngIf="isReservationDetailFetched && data; else detailsLoader"
  class="details-wrapper"
>
  <div class="header">
    <div (click)="closeDetails()" class="close">
      <i class="fa fa-times" aria-hidden="true"></i>
    </div>
    <div class="name-details">
      <div class="name-details-wrapper">
        <div class="name">
          <span>{{ data.getFullName() }}</span>
          <div class="vip-image">
            <img src="assets/VIP.png" />
          </div>
        </div>
        <div class="contact-details">
          <a
            href="tel:{{ data.countryCode }}{{ data.phoneNumber }}"
            *ngIf="data.phoneNumber"
            class="call"
          >
            <mat-icon class="material-icons" matSuffix>call</mat-icon>
            <u>{{ data.countryCode }} {{ data.phoneNumber }}</u>
          </a>
          <a href="mailto:{{ data.email }}" *ngIf="data.email" class="email">
            <mat-icon class="material-icons" matSuffix>email</mat-icon>
            <u>{{ data.email }}</u>
          </a>
        </div>
      </div>
      <div class="header-seperator"></div>
      <div class="name-details-wrapper" style="padding-left: 15px;">
        <div class="name">
          <span>{{ bookingTitle }}</span>
        </div>
        <div class="booking-id-wrapper" (click)="setTabKey('stay_details')">
          <div style="margin-right: 10px;">
            <u>{{ data.booking.bookingNumber }}</u>
          </div>
          <div
            *ngIf="['COMPLETED'].includes(data.feedback.status)"
            class="feedback"
          >
            <!-- <p class="label">Feedback :</p> -->
            <ng-container *ngIf="data.feedback">
              <div class="booking-feedback">
                <p
                  class="number"
                  [ngClass]="{
                    'status-background-reject': data.feedback.rating < 5,
                    'status-background-success': data.feedback.rating >= 5
                  }"
                >
                  {{ data.feedback.rating }}
                </p>
                <ng-container *ngIf="data.feedback.suggestions">
                  <ng-container
                    *ngFor="
                      let suggestion of data.feedback.suggestions.slice(0, 2)
                    "
                  >
                    <img
                      class="feedback-icon"
                      [ngClass]="{
                        'status-image-reject': data.feedback.rating < 5,
                        'status-image-success': data.feedback.rating >= 5
                      }"
                      [src]="feedbackService.getServiceUrl(suggestion.id)"
                    />
                  </ng-container>
                </ng-container>

                <div
                  *ngIf="data.feedback.comments"
                  [ngClass]="{
                    'feedback-msg': data.feedback.comments.length > 0
                  }"
                >
                  {{ data.feedback.comments }}
                </div>
              </div>
            </ng-container>
          </div>
          <div style="margin-right: 10px;">
          <u>  {{ data.rooms.roomNumber }}-{{ data.rooms.type }}</u>
          </div>
        </div>
      </div>
    </div>
    <div class="guest_data">
      <div class="guest_data__feild">
        <div class="label">{{ data.guestAttributes.overAllNps / 10 }}/10</div>
        <div class="value">Overall NPS</div>
      </div>
      <div class="guest_data__feild">
        <div class="label">{{ data.guestAttributes.churnProbalilty }}</div>
        <div class="value">Churn Probability</div>
      </div>
      <div class="guest_data__feild">
        <div class="label">{{ data.guestAttributes.totalSpend }}</div>
        <div class="value">Overall Spent</div>
      </div>
      <div class="guest_data__feild">
        <div class="label">{{ data.guestAttributes.transactionUsage }}</div>
        <div class="value">Potential</div>
      </div>
      <div class="guest_data__feild">
        <div class="label">{{ bookingCount }}</div>
        <div class="value">Bookings</div>
      </div>
    </div>
  </div>
  <div>
    <div class="mat-group">
      <mat-tab-group [selectedIndex]="tabIndex">
        <mat-tab label="Guest Details">
          <hospitality-bot-guest-details
            *ngIf="isReservationDetailFetched"
            [parentForm]="detailsForm"
            [data]="guestData"
            (addFGEvent)="addFGEvent($event)"
          ></hospitality-bot-guest-details>
        </mat-tab>
        <mat-tab label="Documents">
          <hospitality-bot-documents
            *ngIf="isReservationDetailFetched"
            [parentForm]="detailsForm"
            [data]="data"
          >
          </hospitality-bot-documents>
        </mat-tab>
        <mat-tab label="Stay Details" *ngIf="details">
          <hospitality-bot-stay-details
            *ngIf="isReservationDetailFetched"
            [hotelId]="hotelId"
            [parentForm]="detailsForm"
            [data]="details"
            (addFGEvent)="addFGEvent($event)"
          >
          </hospitality-bot-stay-details>
        </mat-tab>
      </mat-tab-group>
      <div *ngIf="isReservationDetailFetched" class="tab-buttons">
        <div class="button-wrapper"></div>
        <p class="contact">Contact Guest</p>
        <div class="right-bottom-icons">
          <div class="social-icons">
            <div class="icon">
              <img src="assets/svg/telegram.svg" />
            </div>
          </div>
          <div class="social-icons">
            <div class="icon">
              <img src="assets/svg/whatsapp.svg" />
            </div>
          </div>
          <div class="social-icons">
            <div class="icon">
              <img src="assets/svg/messenger.svg" />
            </div>
          </div>
          <div class="social-icons">
            <div class="icon">
              <img src="assets/svg/share.svg" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #detailsLoader>
  <div class="loader">
    <p class="loading">Loading</p>
    <div class="spinner">
      <div class="bounce1"></div>
      <div class="bounce2"></div>
      <div class="bounce3"></div>
    </div>
  </div>
</ng-template>
