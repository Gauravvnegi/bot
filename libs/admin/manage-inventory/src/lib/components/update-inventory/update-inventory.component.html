<div [id]="fa?.referenceId">
  <hospitality-bot-navigation-header
    heading="Update inventory"
    [routes]="[{ label: 'Update inventory', link: './' }]"
    [isStickyTitle]="false"
    [isBack]="false"
  >
    <hospitality-bot-button
      label="Bulk update"
      [routerLink]="['inventory-bulk-update']"
      preserveQueryParams="true"
    ></hospitality-bot-button>
  </hospitality-bot-navigation-header>
  <div class="main-wrapper">
    <div class="inventory-form" *ngIf="!!useForm; else loader">
      <div
        [ngClass]="
          !isRoomsEmpty && allRoomTypes?.length
            ? 'wrapper'
            : 'wrapper reduce-height'
        "
        [formGroup]="useForm"
      >
        <!-- LEFT SECTION -->
        <div class="left">
          <div class="left__main">
            <div class="main-header main-header__left">
              <hospitality-bot-room-types
                class="room-types-select"
                [controlName]="'roomType'"
                [props]="{
                  isAllSelected: true
                }"
              >
              </hospitality-bot-room-types>
              <div class="date-wrapper">
                <hospitality-bot-date
                  controlName="date"
                  [settings]="{ enableTime: false, dateFormat: 'M dd, yy' }"
                  [minDate]="currentDate"
                  [disabled]="isRoomsEmpty || !allRoomTypes?.length"
                >
                </hospitality-bot-date>
              </div>
            </div>
            <div
              class="main-section"
              *ngIf="!isRoomsEmpty && allRoomTypes?.length"
            >
              <div
                loader
                [isVisible]="isLoaderVisible"
                [props]="{
                  showLoader: false
                }"
              ></div>
              <div class="heading-section left-main-cell">
                <div class="left-main-cell__left head-cell ttp">
                  <div class="main-text">
                    Total Available Rooms
                  </div>
                  <div class="main-text">
                    (Occupancy%)
                  </div>
                </div>
              </div>
              <ng-container formArrayName="roomTypes">
                <ng-container
                  *ngFor="
                    let roomType of roomTypesControl;
                    let roomTypeIdx = index
                  "
                  [formGroupName]="roomTypeIdx"
                >
                  <div class="input-content-section left-main-cell">
                    <div class="left-main-cell__left">
                      <div class="room-type">
                        {{ roomType.get('label').value }}
                      </div>
                      <!-- TODO: This feature may be used in future -->
                      <!-- <p-toggleButton
                      class="channel-btn"
                      formControlName="showChannels"
                      [offIcon]="'pi pi-angle-down'"
                      [onIcon]="'pi pi-angle-up'"
                      [offLabel]="
                        roomType.get('channels').value.length + ' Channels'
                      "
                      [onLabel]="
                        roomType.get('channels').value.length + ' Channels'
                      "
                      iconPos="right"
                    >
                    </p-toggleButton> -->
                    </div>
                    <div class="left-main-cell__right row-cell ltr">
                      <div class="rates">
                        <p-dropdown
                          formControlName="selectedRestriction"
                          [options]="restrictions"
                          [disabled]="true"
                        ></p-dropdown>
                      </div>
                      <p-toggleButton
                        class="link"
                        formControlName="linked"
                        [offIcon]="'pi pi-link'"
                        [onIcon]="'pi pi-link'"
                      ></p-toggleButton>
                    </div>
                  </div>
                  <ng-container
                    *ngIf="roomType.get('showChannels').value"
                    formArrayName="channels"
                  >
                    <ng-container
                      *ngFor="
                        let channel of roomType.get('channels').controls;
                        let channelIdx = index
                      "
                      [formGroupName]="channelIdx"
                    >
                      <div class="input-content-section left-main-cell p-bg">
                        <div class="left-main-cell__left">
                          <div class="channel">
                            <div class="channel-name">
                              {{ channel.get('label').value }}
                            </div>
                            <img
                              class="channel-icon"
                              src="assets/svg/tick.svg"
                              alt="check"
                            />
                          </div>
                        </div>
                        <div class="left-main-cell__right row-cell ltr w-bg">
                          <div class="rates">
                            <p-dropdown
                              formControlName="selectedRestriction"
                              [options]="restrictions"
                            ></p-dropdown>
                          </div>
                          <p-toggleButton
                            class="link"
                            formControlName="linked"
                            [offIcon]="'pi pi-link'"
                            [onIcon]="'pi pi-link'"
                          ></p-toggleButton>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </div>
          </div>
        </div>

        <!-- RIGHT SECTION -->
        <div class="right">
          <div class="right__main">
            <div class="main-header main-header__right">
              <div class="date-wrapper dates-header">
                <div
                  *ngFor="let date of dates"
                  class="dates-cell cell"
                  [ngClass]="getWeekendBG(date.day)"
                >
                  <div>{{ date.day }}</div>
                  <div>{{ date.date }}</div>
                </div>
              </div>
            </div>
            <div class="main-section" *ngIf="!isRoomsEmpty">
              <div
                loader
                [isVisible]="isLoaderVisible"
                [props]="{
                  top: '50%',
                  left: '25%'
                }"
              ></div>
              <div class="data-cell-wrapper">
                <div class="data-cell heading-section">
                  <div
                    class="cell"
                    *ngFor="let date of dates; let currentPosition = index"
                    [ngClass]="getWeekendBG(date.day, true)"
                  >
                    <div class="main-text">
                      {{ getAvailability(currentPosition, 'qty') }}
                    </div>
                    <div class="seconday-text">
                      {{ getAvailability(currentPosition, 'occupy') }}%
                    </div>
                  </div>
                </div>
              </div>
              <ng-container formArrayName="roomTypes">
                <ng-container
                  *ngFor="
                    let roomType of roomTypesControl;
                    let roomTypeIdx = index
                  "
                  [formGroupName]="roomTypeIdx"
                >
                  <div
                    class="data-cell-wrapper"
                    [formArrayName]="roomType.get('selectedRestriction').value"
                  >
                    <div class="data-cell input-content-section">
                      <div
                        class="cell"
                        *ngFor="let date of dates; let controlIdx = index"
                        [formGroupName]="controlIdx"
                        [ngClass]="getWeekendBG(date.day)"
                      >
                        <ng-container
                          [ngSwitch]="
                            restrictionsRecord[
                              roomType.get('selectedRestriction').value
                            ].type
                          "
                        >
                          <hospitality-bot-input
                            [isHideSpinners]="true"
                            *ngSwitchCase="'number'"
                            controlName="value"
                            min="0"
                            [props]="{
                              type: 'number',
                              errorMessages: {
                                min: 'Invalid'
                              }
                            }"
                          ></hospitality-bot-input>
                          <hospitality-bot-input-switch
                            *ngSwitchCase="'boolean'"
                            controlName="value"
                          >
                          </hospitality-bot-input-switch>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                  <ng-container
                    *ngIf="roomType.get('showChannels').value"
                    formArrayName="channels"
                  >
                    <ng-container
                      *ngFor="
                        let channel of roomType.get('channels').controls;
                        let channelIdx = index
                      "
                      [formGroupName]="channelIdx"
                    >
                      <div
                        class="data-cell-wrapper"
                        [formArrayName]="
                          channel.get('selectedRestriction').value
                        "
                      >
                        <div class="data-cell input-content-section">
                          <div
                            class="cell"
                            *ngFor="let date of dates; let controlIdx = index"
                            [formGroupName]="controlIdx"
                            [ngClass]="getWeekendBG(date.day)"
                          >
                            <ng-container
                              [ngSwitch]="
                                restrictionsRecord[
                                  channel.get('selectedRestriction').value
                                ].type
                              "
                            >
                              <hospitality-bot-input
                                *ngSwitchCase="'number'"
                                controlName="value"
                                [isHideSpinners]="true"
                              ></hospitality-bot-input>
                              <hospitality-bot-input-switch
                                *ngSwitchCase="'boolean'"
                                controlName="value"
                              >
                              </hospitality-bot-input-switch>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <ng-container
        *ngIf="!isRoomsEmpty && allRoomTypes?.length; else emptyView"
      ></ng-container>
    </div>
    <ng-template #loader>
      <hospitality-bot-loader-bounce></hospitality-bot-loader-bounce>
    </ng-template>
    <ng-template #emptyView>
      <hospitality-bot-empty-table
        [isLoading]="loading"
        [content]="{
          description: allRoomTypes?.length
            ? 'Please select at least one rooms'
            : 'There is no room available',
          imageSrc: 'assets/images/empty-table-service.png'
        }"
      >
      </hospitality-bot-empty-table>
    </ng-template>

    <hospitality-bot-form-action
      class="full-width"
      [loading]="loading"
      [disabled]="
        loading || loadingError || !(!isRoomsEmpty && allRoomTypes?.length)
      "
      [config]="{
        preHide: true,
        postLabel: 'Save'
      }"
      (onPostAction)="handleSave()"
      #fa
    >
    </hospitality-bot-form-action>
  </div>
</div>
