<ng-container *ngIf="!displayBookingOffer; else bookingOffer">
  <div class="summary-wrapper">
    <div class="bk-summary_heading page-heading">Reservation Summary</div>
    <!-- <p class="divider"></p> -->
    <div class="container">
      <div
        class="bk-summary_subheading"
        *ngIf="bookingType === 'ROOM_TYPE' && summaryData?.bookingItems"
      >
        {{ (summaryData?.bookingItems)[0]?.roomTypeLabel }}
        <span class="room-count" *ngIf="summaryData?.bookingItems.length > 1"
          >+{{ summaryData?.bookingItems.length - 1 }}</span
        >
      </div>
      <div class="bk-summary_subheading" *ngIf="heading">
        {{ heading }}
      </div>
      <div class="bk-summary_subheading_label">
        {{ summaryData?.location }}
      </div>

      <div class="bk-summary_roomInfo">
        <ng-content *ngIf="!displayBookingOffer"></ng-content>
      </div>
      <div class="bk-summary_offerInfo" *ngIf="bookingType === 'ROOM_TYPE'">
        <ng-container
          *ngIf="
            controlContainer.control.get('offerId').value &&
              selectedOffer?.description;
            else selectOffer
          "
        >
          <p>
            Offer Applied
          </p>
          <div class="offer">
            <div
              [innerHtml]="selectedOffer.description"
              class="offer_card"
            ></div>
            <div class="offer_gift">
              <img src="assets/svg/offer_gift.svg" alt="offer gift" />
            </div>
            <div class="offer_cross" (click)="offerSelect()">
              <img src="assets/images/cross.png" alt="cross" />
            </div>
          </div>
        </ng-container>
        <ng-template #selectOffer>
          <p>
            Have an Offer?
            <span (click)="displayBookingOffer = !displayBookingOffer"
              >Apply Offer</span
            >
          </p>
        </ng-template>
      </div>
      <ng-container
        *ngIf="bookingType === 'ROOM_TYPE' && summaryData?.bookingItems.length"
      >
        <ng-container
          [ngTemplateOutlet]="summaryTemplate"
          [ngTemplateOutletContext]="{
            bookingItem: summaryData
          }"
        >
        </ng-container>
      </ng-container>
      <div class="view-details-btn" *ngIf="bookingType === 'ROOM_TYPE'">
        <hospitality-bot-button
          class="btn"
          *ngIf="summaryData?.bookingItems.length > 1"
          [label]="detailsView ? 'View Less' : 'View Details'"
          variant="text"
          (onClick)="detailsView = !detailsView"
        ></hospitality-bot-button>
      </div>
      <ng-container *ngIf="bookingType === 'ROOM_TYPE' && detailsView">
        <ng-container
          *ngFor="
            let bookingItem of summaryData?.bookingItems;
            let index = index
          "
        >
          <ng-container
            [ngTemplateOutlet]="summaryTemplate"
            [ngTemplateOutletContext]="{
              bookingItem: bookingItem,
              index: index
            }"
          >
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-container *ngIf="bookingType === '!ROOM_TYPE'">
        <ng-container
          [ngTemplateOutlet]="outletSummaryTemplate"
          [ngTemplateOutletContext]="{
            summaryData: summaryData
          }"
        >
        </ng-container>
      </ng-container>
      <!-- when there is no summary -->
      <ng-container
        *ngIf="bookingType === 'ROOM_TYPE' && !summaryData?.bookingItems.length"
      >
        <ng-container [ngTemplateOutlet]="summaryTemplate"> </ng-container>
      </ng-container>
      <ng-container *ngIf="bookingType === '!ROOM_TYPE' && !summaryData">
        <ng-container [ngTemplateOutlet]="outletSummaryTemplate">
        </ng-container>
      </ng-container>
      <p
        class="bk-summary_priceInfo_perNight"
        *ngIf="paymentControls?.totalPaidAmount.value"
      >
        <span class="bk-summary_priceInfo_perNight_label">Paid Amount</span>
        <span class="bk-summary_priceInfo_perNight_amount"
          >-{{ paymentControls.totalPaidAmount.value | currency: 'INR' }}</span
        >
      </p>
    </div>
    <p class="divider"></p>
    <div class="footer">
      <div class="bk-summary_total">
        <p class="bk-summary_total_label">Total Amount to be paid</p>
        <p class="bk-summary_total_amount">
          {{
            summaryData?.totalAmount -
              (paymentControls.totalPaidAmount.value
                ? paymentControls.totalPaidAmount.value
                : 0) | currency: 'INR'
          }}
        </p>
      </div>
      <div class="bk-summary_btn-wrapper">
        <hospitality-bot-button
          (click)="handleBooking()"
          label="{{ this.reservationId ? 'Update' : 'Confirm' }} Reservation"
          [disabled]="controlContainer.control.invalid || disabledForm"
          [isLoading]="isBooking"
        ></hospitality-bot-button>
      </div>
    </div>
  </div>
</ng-container>
<ng-template #bookingOffer>
  <div class="bk-summary_heading page-heading">
    <mat-icon (click)="displayBookingOffer = !displayBookingOffer"
      >arrow_back</mat-icon
    >
    Offers
  </div>
  <div class="offersList">
    <ng-container *ngIf="offersList?.records?.length; else emptyOffer">
      <div *ngFor="let item of offersList?.records" class="offer">
        <div class="offer" (click)="offerSelect(item)">
          <div [innerHtml]="item.description" class="offer_card"></div>
          <div class="offer_gift">
            <img src="assets/svg/offer_gift.svg" alt="offer gift" />
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <ng-template #emptyOffer>
    <div class="empty-offer-view">
      <div class="offer_box">
        <img src="assets/svg/empty_box.svg" alt="empty box" />
      </div>
      <div class="offer_text">
        Currently You do not have any Offer
      </div>
    </div>
  </ng-template>
</ng-template>

<ng-template #outletSummaryTemplate let-summaryData="summaryData">
  <p class="bk-summary_priceInfo_person">
    <span class="bk-summary_priceInfo_perNight_label">
      For {{ summaryData?.maxAdult ? summaryData.maxAdult : 0 }} Adults
    </span>
    <span class="bk-summary_priceInfo_perNight_amount">
      {{ summaryData?.basePrice | currency: 'INR' }}
    </span>
  </p>
  <p class="bk-summary_priceInfo_taxFair">
    <span class="bk-summary_priceInfo_perNight_label"
      >Taxes & Fees <i class="fa fa-info-circle" aria-hidden="true"></i
    ></span>
    <span
      class="bk-summary_priceInfo_perNight_amount"
      *ngIf="summaryData?.taxAndFees"
      >+{{ summaryData?.taxAndFees | currency: 'INR' }}</span
    >
  </p>
</ng-template>

<ng-template #summaryTemplate let-index="index" let-bookingItem="bookingItem">
  <p *ngIf="index || index === 0" class="divider"></p>
  <div class="bk-summary_priceInfo">
    <div class="bk-summary_subheading" *ngIf="index || index === 0">
      {{ bookingItem?.roomTypeLabel }}
      <span class="room-count"> x{{ bookingItem?.roomCount }} </span>
    </div>
    <p class="bk-summary_priceInfo_perNight">
      <span class="bk-summary_priceInfo_perNight_label"
        >For {{ dateDifference }}
        {{ dateDifference > 1 ? 'nights' : 'night' }}</span
      >
      <!-- <s class="bk-summary_priceInfo_perNight_amount">{{
        bookingItem?.totalAmount | currency: 'INR'
      }}</s> -->
    </p>
    <p class="bk-summary_priceInfo_person">
      <span class="bk-summary_priceInfo_perNight_label">
        For
        {{
          bookingItem?.maxAdult
            ? bookingItem.maxAdult
            : occupancyDetails.adultCount
        }}
        Adults
        {{
          bookingItem?.maxChild
            ? bookingItem.maxChild
            : occupancyDetails.childCount
        }}
        Kids
      </span>
      <span class="bk-summary_priceInfo_perNight_amount">
        {{ bookingItem?.basePrice | currency: 'INR' }}
      </span>
    </p>
    <p class="bk-summary_priceInfo_taxFair" *ngIf="summaryData?.offerAmount">
      <span class="bk-summary_priceInfo_perNight_label"
        >Discount<i class="fa fa-info-circle" aria-hidden="true"></i
      ></span>
      <span class="bk-summary_priceInfo_perNight_amount">{{
        summaryData?.offerAmount | currency: 'INR'
      }}</span>
    </p>
    <p class="bk-summary_priceInfo_taxFair">
      <span class="bk-summary_priceInfo_perNight_label"
        >Taxes & Fees <i class="fa fa-info-circle" aria-hidden="true"></i
      ></span>
      <span
        class="bk-summary_priceInfo_perNight_amount"
        *ngIf="bookingItem?.taxAndFees"
        >+{{ bookingItem?.taxAndFees | currency: 'INR' }}</span
      >
    </p>
  </div>
</ng-template>
