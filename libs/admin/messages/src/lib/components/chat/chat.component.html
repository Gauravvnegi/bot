<div style="height: 100%;">
  <div
    style="
      height: 62px;
      width: 100%;
      background: #ffffff;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #9eaeb8;
      cursor: pointer;
    "
    (click)="openGuestInfo()"
  >
    <div
      style="
        width: 28px;
        height: 28px;
        border-radius: 50%;
        margin: 0 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      "
      [style.background]="selectedChat?.color"
    >
      <img
        [src]="chat?.receiver?.profileUrl"
        *ngIf="chat?.receiver?.profileUrl; else defaultAvatar"
      />
      <ng-template #defaultAvatar
        ><div>
          {{ selectedChat?.getProfileNickName() }}
        </div></ng-template
      >
    </div>
    <div
      style="
        font: normal normal medium 14px/19px Roboto;
        letter-spacing: 0.84px;
        color: #002046;
        opacity: 1;
      "
    >
      {{ selectedChat ? selectedChat?.name || selectedChat?.phone : '' }}
    </div>
  </div>
  <div
    style="
      height: calc(100% - 124px);
      background: #f1f1f1;
      overflow-y: auto;
      padding: 20px;
      position: relative;
      width: 100%;
    "
    (scroll)="onScroll($event)"
    *ngIf="chatDates.length; else noChat"
    #scrollMe
  >
    <ng-container *ngFor="let date of chatDates">
      <div
        style="
          text-align: center;
          margin-bottom: 10px;
          font-family: Roboto;
          font-size: 12px;
          font-weight: normal;
          font-stretch: normal;
          font-style: normal;
          line-height: normal;
          letter-spacing: 0.72px;
          color: #002046;
        "
      >
        {{ date }}
      </div>
      <div
        *ngFor="let message of chatList.messages[selectedChat.receiverId][date]"
        style="display: flex;"
        [ngStyle]="
          message.direction === 'OUTBOUND'
            ? { 'justify-content': 'flex-end' }
            : {}
        "
      >
        <div
          [ngClass]="
            message.direction === 'OUTBOUND' ? 'right-message' : 'left-message'
          "
          [ngStyle]="
            message.status === 'sent' ? { opacity: '1' } : { opacity: '0.5' }
          "
        >
          <div
            [ngClass]="
              message.direction === 'OUTBOUND'
                ? 'right-message__text'
                : 'left-message__text'
            "
          >
            <ng-container *ngIf="message.text; else image">{{
              message.text
            }}</ng-container>
            <ng-template #image
              ><img style="max-width: 100%;" [src]="message.url" />
              <div>{{ message.caption }}</div></ng-template
            >
          </div>
          <div class="message__time">{{ message.getTime() }}</div>
        </div>
      </div>
    </ng-container>
  </div>
  <ng-template #noChat>
    <div
      style="
        height: calc(100% - 124px);
        background: #f1f1f1;
        overflow-y: auto;
        padding: 20px;
        position: relative;
      "
    ></div>
  </ng-template>
  <ng-container *ngIf="this.chatList.receiver[selectedChat.receiverId]">
    <div
      style="
        height: 62px;
        width: 100%;
        background: #ffffff;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      "
      *ngIf="
        chatFG && this.chatList.receiver[selectedChat.receiverId]?.enableSend;
        else noSend
      "
    >
      <div style="height: 100%; width: 100%;" [formGroup]="chatFG">
        <div
          class=""
          style="position: relative; height: 100%; width: calc(100% - 10px);"
        >
          <input
            matInput
            type="text"
            class="message-field-input"
            placeholder="Type Message"
            formControlName="message"
            (keyup)="checkForEnterKey($event)"
          />
          <img
            src="assets/svg/smile.svg"
            style="
              position: absolute;
              right: 10px;
              top: 48%;
              transform: translateY(-50%);
            "
          />
        </div>
      </div>
      <div style="cursor: pointer;" (click)="sendMessage()">
        <img src="assets/svg/send-message.svg" />
      </div>
    </div>
    <ng-template #noSend>
      <div
        style="
          height: 62px;
          width: 100%;
          background: #ffffff;
          padding: 10px 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          font: normal normal normal 14px/19px Roboto;
          letter-spacing: 0.84px;
          color: #fb3d4e;
        "
      >
        As per WhatsApp's rules, you can only respond to a user within 24 hours
        of their messages.
      </div>
    </ng-template>
  </ng-container>
</div>
