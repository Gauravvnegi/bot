<div class="summary-wrapper">
  <ng-container *ngIf="selectedItems.length; else emptyView">
    <div class="btn-wrapper">
      <hospitality-bot-button
        label="Clear"
        variant="text"
        (onClick)="clear()"
        minWidth="50px"
      ></hospitality-bot-button>
    </div>

    <ng-container [formGroup]="parentFormGroup">
      <div class="items-wrapper">
        <ng-container formGroupName="kotInformation">
          <ng-container formArrayName="kotItems">
            <ng-container
              *ngFor="let kotControls of kotFormArray.controls; let i = index"
            >
              <ng-container [formGroupName]="i">
                <p-accordion [multiple]="true">
                  <p-accordionTab click [selected]="true">
                    <p-header>
                      <div class="heading">KOT {{ 1 }}</div>
                      <span class="amount">Qty: {{ totalItemUnits }}</span>
                    </p-header>
                    <div class="items-content" formArrayName="items">
                      <ng-container
                        *ngFor="
                          let itemControls of kotFormArray.at(i).get('items')
                            .controls;
                          let j = index
                        "
                      >
                        <ng-container [formGroupName]="j">
                          <div
                            class="selected-item"
                            *ngIf="itemControls.value.unit > 0"
                          >
                            <div class="item-name-wrapper">
                              <img
                                [src]="
                                  mealPreferenceConfig[
                                    selectedItems[j].mealPreference
                                  ].image
                                "
                              />
                              <div class="item-name">
                                <span class="name">{{
                                  itemControls.value.itemName
                                }}</span>
                                <span
                                  *ngIf="
                                    !itemFormArray
                                      .at(j)
                                      ?.get('viewItemInstruction')?.value
                                  "
                                  class="instructions"
                                  (click)="
                                    toggleControlVisibility(
                                      'ItemInstruction',
                                      j,
                                      itemFormArray
                                    )
                                  "
                                >
                                  {{
                                    itemFormArray.at(j)?.get('itemInstruction')
                                      ?.value
                                      ? 'Edit Instruction'
                                      : 'Add Instruction'
                                  }}
                                </span>
                              </div>
                            </div>
                            <div class="items-count">
                              <img
                                src="assets/svg/remove-item-black.svg"
                                (click)="decrementQuantity(itemControls)"
                              />
                              <p>{{ itemControls.value.unit }}</p>
                              <img
                                src="assets/svg/add-item-black.svg"
                                (click)="incrementQuantity(itemControls)"
                              />
                            </div>
                          </div>
                          <hospitality-bot-input
                            class="item-instruction"
                            *ngIf="
                              itemFormArray.at(j)?.get('viewItemInstruction')
                                ?.value
                            "
                            controlName="itemInstruction"
                            [props]="{
                              placeholder: 'Enter'
                            }"
                            [viewButton]="true"
                            (onSaveText)="
                              toggleControlVisibility(
                                'ItemInstruction',
                                j,
                                itemFormArray
                              )
                            "
                          ></hospitality-bot-input>
                        </ng-container>
                      </ng-container>
                    </div>
                    <div class="item-footer">
                      <span
                        *ngIf="
                          !kotFormArray.at(i)?.get('viewKotInstruction')?.value
                        "
                        class="instructions"
                        (click)="
                          toggleControlVisibility(
                            'Instruction',
                            i,
                            kotFormArray
                          )
                        "
                      >
                        {{
                          kotFormArray.at(i)?.get('kotInstruction')?.value
                            ? 'Edit Instruction'
                            : 'Add Instruction'
                        }}
                      </span>
                      <hospitality-bot-input
                        *ngIf="
                          kotFormArray.at(i)?.get('viewKotInstruction')?.value
                        "
                        controlName="kotInstruction"
                        [props]="{
                          placeholder: 'Enter'
                        }"
                        [viewButton]="true"
                        (onSaveText)="
                          toggleControlVisibility(
                            'Instruction',
                            i,
                            kotFormArray
                          )
                        "
                      ></hospitality-bot-input>
                      <div class="offer-wrapper">
                        <p *ngIf="!viewOffer">
                          Have an Offer?
                          <span (click)="viewOffer = true" class="apply-btn"
                            >Apply Offer</span
                          >
                        </p>
                        <hospitality-bot-multi-select
                          *ngIf="viewOffer"
                          controlName="kotOffer"
                          [options]="itemOffers"
                          [settings]="{
                            placeholder: 'Apply Offer',
                            showChips: false,
                            showHeaders: false,
                            maxSelectedLabels: 1
                          }"
                        ></hospitality-bot-multi-select>
                        <!-- Have an Offer?
                        <span
                          class="offer"
                          (click)="
                            toggleControlVisibility('Offer', i, kotFormArray)
                          "
                        >
                          Apply Offer
                          <img
                            [ngClass]="{
                              'rotated-up': kotFormArray
                                .at(i)
                                ?.get('viewKotOffer')?.value
                            }"
                            src="assets/svg/union.svg"
                          />
                        </span>
                        <hospitality-bot-input
                          *ngIf="kotFormArray.at(i)?.get('viewKotOffer')?.value"
                          controlName="kotOffer"
                        ></hospitality-bot-input> -->
                      </div>
                    </div>
                  </p-accordionTab>
                </p-accordion>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </div>
      <ng-container formGroupName="paymentInformation">
        <div class="payment-wrapper">
          <p class="payment-header">Bill Details</p>
          <div class="payment-details">
            <ul>
              <li class="payment-item">
                <span>Total Charges</span>
                <span>{{ totalAmount | currency: 'INR' }} </span>
              </li>
              <!-- <li class="payment-item">
                <span>Total Container Charges</span>
                <span>{{ 223 | currency: 'INR' }} </span>
              </li> -->
              <li class="payment-item">
                <span>Total Discount</span>
                <span>{{ 0 | currency: 'INR' }} </span>
              </li>
              <li class="payment-item">
                <span>Total Payable</span>
                <span>{{ totalAmount | currency: 'INR' }} </span>
              </li>
              <li class="payment-item">
                <span>Total Paid Amount</span>
                <span>{{ 0 | currency: 'INR' }} </span>
              </li>
            </ul>
            <div class="remaining-balance">
              <span>Remaining Balance</span>
              <span>{{
                totalAmount - paymentControls.paymentRecieved.value
                  | currency: 'INR'
              }}</span>
            </div>
          </div>
          <div class="form-block">
            <hospitality-bot-checkbox
              class="half-width"
              label="Complementery"
              controlName="complementery"
            ></hospitality-bot-checkbox>
            <hospitality-bot-select-group
              class="full-width select-group"
              controlName="paymentMethod"
              [options]="paymentOptions"
            ></hospitality-bot-select-group>
            <hospitality-bot-input
              class="half-width"
              controlName="paymentRecieved"
              [props]="{
                placeholder: 'Payment Recieved'
              }"
            ></hospitality-bot-input>
            <hospitality-bot-input
              class="half-width"
              controlName="transactionId"
              [props]="{
                placeholder: 'Transaction ID'
              }"
            ></hospitality-bot-input>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</div>

<ng-template #emptyView>
  <div class="empty-view">
    <img src="assets/svg/no-items.svg" alt="Empty" />
    <h2>No items selected</h2>
    <p>Select the item from the left menu</p>
  </div>
</ng-template>
