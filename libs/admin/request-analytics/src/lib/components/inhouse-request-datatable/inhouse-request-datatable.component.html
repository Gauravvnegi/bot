<div class="popup__wrap">
  <div (click)="closeModal()" class="popup__wrap__close">&#10006;</div>
  <div class="caption__wrapper">
    <form [formGroup]="tableFG">
      <div class="caption__wrapper--tabmenu">
        <div class="header">
          <p class="heading">{{ tableName }}</p>
          <div class="action-wrapper">
            <hospitality-bot-export-list
              (onDocumentActions)="onDocumentActions()"
              [documentTypes]="documentTypes"
              [documentActionTypes]="documentActionTypes"
            ></hospitality-bot-export-list>
          </div>
        </div>
      </div>
    </form>
  </div>

  <p-table
    #dt
    [styleClass]="tableConfig.styleClass"
    [resizableColumns]="isResizableColumns"
    [autoLayout]="isAutoLayout"
    [loading]="loading"
    [columns]="cols"
    [value]="values"
    [paginator]="isPaginator"
    [rows]="rowsPerPage"
    [showCurrentPageReport]="showCurrentPageReport"
    [rowsPerPageOptions]="rowsPerPageOptions"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [(first)]="first"
    [totalRecords]="totalRecords"
    [filterDelay]="0"
    [selectionMode]="selectionMode"
    [(selection)]="selectedRows"
    (onRowSelect)="onRowSelect($event)"
    (onRowUnselect)="onRowUnselect($event)"
    (sortFunction)="customSort($event)"
    [customSort]="isCustomSort"
    *ngIf="tabFilterItems[tabFilterIdx]?.total; else emptyTable"
  >
    <ng-template pTemplate="caption" [formGroup]="tableFG">
      <div class="caption__wrapper">
        <ng-container [ngTemplateOutlet]="tabFilter"> </ng-container>

        <hospitality-bot-filter-chips
          *ngIf="isQuickFilters"
          [chips]="tabFilterItems[tabFilterIdx].chips"
          (onChange)="toggleQuickReplyFilter($event)"
        ></hospitality-bot-filter-chips>
      </div>
    </ng-template>

    <!-- *******************************EMPTY TABLE VIEW******************************* -->
    <ng-template pTemplate="emptymessage">
      <tr hospitality-bot-empty-view [noOfColumns]="cols.length"></tr>
    </ng-template>

    <!-- *******************************HEADER WITH SEARCH******************************* -->
    <ng-template pTemplate="header" let-columns>
      <tr
        hospitality-bot-table-header
        [columns]="columns"
        [showCheckbox]="isSelectable"
        (search)="handleFieldSearch($event)"
      ></tr>
    </ng-template>

    <!-- **************************************BODY********************************* -->
    <ng-template
      pTemplate="body"
      let-rowData
      let-columns="columns"
      let-rowIndex="rowIndex"
    >
      <tr class="data-table-row">
        <td class="table--checkbox">
          <p-tableCheckbox
            [value]="rowData"
            [index]="rowIndex"
            (click)="onCheckboxClicked($event)"
          ></p-tableCheckbox>
        </td>
        <td>
          <p>{{ rowData.itemCode }}</p>
          <p class="{{ rowData.priority | lowercase }}">
            {{ rowData.priority }}
          </p>
          <p>{{ rowData.quantity }}</p>
        </td>
        <td>
          <p>{{ rowData.confirmationNumber }}</p>
          <p [roomStatus]="rowData.rooms[0]?.status">
            {{ rowData.rooms[0].roomNumber }} - {{ rowData.rooms[0].type }}
          </p>
          <p>{{ rowData.quantity }}</p>
        </td>
        <td>
          <p>{{ rowData.guestDetails.primaryGuest.getFullName() }}</p>
        </td>
        <td>
          <a href="tel:{{ rowData.guestDetails.primaryGuest.phoneNumber }}">
            <p class="email">
              {{ rowData.guestDetails.primaryGuest.countryCode }}-{{
                rowData.guestDetails.primaryGuest.phoneNumber
              }}
            </p>
          </a>
          <p class="email">{{ rowData.guestDetails.primaryGuest.email }}</p>
        </td>
        <td>
          <p class="item-name">{{ rowData.itemName }}</p>
          <p class="light">{{ rowData.remarks }}</p>
          <div class="job-duration">
            <div>{{ rowData.action }}</div>
            <div>JD :- {{ rowData.jobDuration }}min</div>
          </div>
        </td>
        <td>
          <p class="date-time">
            {{
              rowData.getRequestDateTime(globalFilterService.timezone) ||
                '- - - - -'
            }}
          </p>
          <p class="date-time">
            {{
              rowData.getClosedTime(globalFilterService.timezone) || '- - - - -'
            }}
          </p>
        </td>
        <td>
          <mat-select
            class="form-elements"
            placeholder=""
            [value]="rowData.action"
            [disabled]="
              rowData.action === 'Closed' ||
              rowData.action === 'Timeout' ||
              rowData.action === 'Reject'
            "
            (selectionChange)="handleStatusChange(rowData, $event)"
          >
            <mat-option
              [value]="item"
              *ngFor="let item of optionLabels"
              [disabled]="item === 'Timeout'"
              >{{ item }}</mat-option
            >
          </mat-select>
        </td>
      </tr>
    </ng-template>

    <!-- *********************************FOOTER******************************* -->
    <ng-template pTemplate="summary">
      <p-paginator
        #paginator
        [rows]="rowsPerPage"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="rowsPerPageOptions"
        (onPageChange)="paginate($event)"
        [currentPageReportTemplate]="reportTemplate"
        showCurrentPageReport="true"
      ></p-paginator>
    </ng-template>
  </p-table>
</div>

<ng-template #emptyTable>
  <hospitality-bot-empty-table
    [content]="{
      description: 'No pending requests from in-house guests.',
      imageSrc: 'assets/images/empty-table-in-house.png'
    }"
  >
    <ng-container [ngTemplateOutlet]="tabFilter"> </ng-container>
  </hospitality-bot-empty-table>
</ng-template>

<ng-template #tabFilter>
  <hospitality-bot-tab-group
    [selectedIndex]="tabFilterIdx"
    *ngIf="isTabFilters"
    [listItems]="tabFilterItems"
    (selectedTabChange)="onSelectedTabFilterChange($event)"
  ></hospitality-bot-tab-group>
</ng-template>
