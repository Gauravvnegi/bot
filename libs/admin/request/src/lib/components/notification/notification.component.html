<div class="container">
  <div class="request-header">
    <div style="padding: 5px">
      <mat-icon class="back-icon" (click)="goBack()">keyboard_backspace</mat-icon>
    </div>
    <div style="padding-left: 10px;">Send Message</div>
  </div>
  <form [formGroup]="notificationForm">
    <div class="request-body">
      <div class="row">
        <div class="row-title">Channel:</div>
        <div class="row-body">
          <div style="display: flex; align-items: center;" *ngIf="config.channels.bot">
            <mat-checkbox formControlName="is_social_channel" (change)="modifyControl($event.checked, 'social_channels')"></mat-checkbox>
            <mat-form-field style="margin-left: 10px;">
              <mat-select multiple formControlName="social_channels" [disabled]="!isSocialChannel" (selectionChange)="changeSocialChannels($event.value)">
                <mat-select-trigger *ngIf="social_channels">
                  {{ social_channels.value ? social_channels.value[0] : '' }}
                  <span
                    *ngIf="social_channels.value?.length > 1"
                    class="additional-selection"
                  >
                    (+{{ social_channels.value.length - 1 }}
                    {{ social_channels.value?.length === 2 ? 'other' : 'others' }})
                  </span>
                </mat-select-trigger>
                <mat-option
                  *ngFor="let channel of config.channels.bot.options"
                  [value]="channel.value"
                  >{{ channel.label }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div><mat-checkbox formControlName="is_email_channel" *ngIf="config.channels.email" (change)="modifyControl($event.checked, 'emailIds')"> Email </mat-checkbox></div>
          <div><mat-checkbox formControlName="is_sms_channel" *ngIf="config.channels.sms"> SMS </mat-checkbox></div>
        </div>
      </div>
  
      <div class="row">
        <div class="row-title">Message Type:</div>
        <div class="row-body">  
          <div>
            <mat-form-field>
              <mat-select formControlName="messageType" (selectionChange)="changeTemplateIds($event.value)">
                <mat-option
                  *ngFor="let messageType of config.messageTypes"
                  [value]="messageType.value"
                  >{{ messageType.label }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>  
          <div style="display: flex; align-items: center;">
            <div style="width: 130px;color: rgb(199, 196, 196); font-size: 14px;">Template:</div>
            <mat-form-field>
              <mat-select formControlName="templateId">
                <mat-option
                  value=""
                  >No data</mat-option>
                <mat-option
                  *ngFor="let messageType of templates.ids"
                  [value]="messageType.value"
                  >{{ messageType.label }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>    
        </div>
      </div>
      <div class="col" *ngIf="isEmailChannel">
        <div class="row">
          <div class="row-title">Email :</div>
          <div class="row-body">
            <mat-form-field class="chip-list" appearance="outline">
              <mat-chip-list #chipList aria-label="Email selection">
                <mat-chip
                  *ngFor="let email of emailIds.value"
                  selectable="true"
                  removable="true"
                  (removed)="removeEmail(email)"
                >{{ email }}<mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
                <input
                  placeholder="Email"
                  [matChipInputFor]="chipList"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  matChipInputAddOnBlur="true"
                  (matChipInputTokenEnd)="addEmail($event)"
                />
              </mat-chip-list>
            </mat-form-field>
          </div>
        </div>
        <div class="upload-btn-wrapper">
          <input type="file" #emailCsvReader name="Upload CSV" (change)="readDataFromCSV($event, emailIds)" accept=".csv" />
          <div class="import"><img src="assets/svg/import.svg" /><div>Import</div></div>
        </div>
      </div>
      <div class="col">
        <div class="row">
          <div class="row-title">Room# :</div>
          <div class="row-body">
            <hospitality-bot-multiple-dropdown
              style="width: 100%;"
              [allItems]="rooms"
              [items]="roomNumbers.value || [] "
              (updateData)="setRoomData($event)"></hospitality-bot-multiple-dropdown>
          </div>
        </div>
        <div class="upload-btn-wrapper">
          <input type="file" #roomCsvReader name="Upload CSV" (change)="readDataFromCSV($event, roomNumbers)" accept=".csv" />
          <div class="import"><img src="assets/svg/import.svg" /><div>Import</div></div>
        </div>
      </div>
      <div class="row">
        <div class="row-title base-align">Input Message:</div>
        <div class="row-body">
          <ckeditor [editor]="Editor" style="width: 100%;" formControlName="message"></ckeditor>
        </div>
      </div>
      <div class="row">
        <div class="row-title">Attachment:</div>
        <div class="row-body">
          <div class="upload-attachment-wrapper">
            <input type="file" #attachmentUpload name="Upload CSV" (change)="uploadAttachments($event)" />
            <div class="attachment">
              <div>{{ attachment }}</div><div><mat-icon matSuffix>attachment</mat-icon></div>
            </div>
          </div>
        </div>
      </div>
      <div style="align-self: center;">
        <button class="button" (click)="sendMessage()"> Send </button>
      </div>
    </div>
  </form>
</div>
