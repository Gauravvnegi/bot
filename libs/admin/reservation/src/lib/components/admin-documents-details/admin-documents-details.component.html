<div class="material-body">
  <div>
    <div class="document-header">
      <div class="heading">
        <p class="label">Guest Documents</p>
        <ng-container [ngSwitch]="documentStatus.get('status').value">
          <img
            *ngSwitchCase="'COMPLETED'"
            src="assets/svg/status/success.svg"
            alt="completed"
          />

          <img
            *ngSwitchCase="'FAILED'"
            src="assets/svg/status/fail.svg"
            alt="fail"
          />

          <img
            *ngSwitchCase="'PENDING'"
            src="assets/svg/status/pending.svg"
            alt="pending"
          />

          <img
            *ngSwitchCase="'INITIATED'"
            src="assets/svg/status/initiated.svg"
            alt="initiated"
          />
        </ng-container>
      </div>

      <div
        class="download"
        *ngIf="selectedGuestGroup"
        (click)="saveDocument()"
        [ngClass]="{
          download__disabled: !updatedDocGuest.includes(this.selectedGuestId)
        }"
      >
        <img src="assets/svg/uparrow.svg" alt="document" /> &nbsp;
        <p>Update Docs</p>
      </div>
      <div
        class="download"
        *ngIf="selectedGuestGroup"
        (click)="downloadDocs(selectedGuestGroup.get('documents').value)"
      >
        <img src="assets/svg/d_document.svg" alt="document" /> &nbsp;
        <p>Download All Docs</p>
      </div>
    </div>
    <ng-container *ngIf="selectedGuestGroup">
      <form [formGroup]="selectedGuestGroup">
        <div class="wrapper">
          <div class="document-name-nationality">
            <mat-form-field class="nationality">
              <mat-select
                [(value)]="selectedGuestId"
                (selectionChange)="onGuestChange($event.value)"
              >
                <mat-option
                  *ngFor="let guest of detailsData.guestDetails.guests"
                  [value]="guest.id"
                >
                  {{ guest.title }} {{ guest.firstName }} {{ guest.lastName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <div class="select-field__wrapper">
              <div class="select-field">
                <span class="label">Nationality :</span>
                <mat-form-field *ngIf="selectedGuestGroup">
                  <mat-select
                    [(value)]="selectedGuestGroup.get('nationality').value"
                    formControlName="nationality"
                    [disabled]="false"
                  >
                    <mat-option
                      *ngFor="let country of countriesLOV"
                      [value]="country.value"
                    >
                      {{ country.label }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="select-field">
                <span class="label">Document Type :</span>
                <mat-form-field *ngIf="selectedGuestGroup">
                  <mat-select
                    [(value)]="
                      selectedGuestGroup.get('selectedDocumentType').value
                    "
                    formControlName="selectedDocumentType"
                    [disabled]="false"
                  >
                    <mat-option *ngFor="let doc of documentsList" [value]="doc">
                      {{ doc }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="nationality-wrapper"></div>

          <div *ngIf="!!this.documentFormGroup.controls?.length; else emptyDoc">
            <ng-container
              formArrayName="documents"
              *ngFor="
                let document of selectedGuestGroup.get('documents').controls;
                let i = index
              "
            >
              <div class="upload-image-wrapper" [formGroupName]="i">
                <div
                  class="upload-image"
                  *ngIf="
                    document.get('settings').value['frontImage'] !==
                    'not-required'
                  "
                >
                  <hospitality-bot-upload-file
                    [fileUploadData]="fileUploadData"
                    [url]="document.get('frontUrl').value"
                    [pageType]="'front'"
                    (fileData)="uploadDocuments($event, 'front', i)"
                    [documentType]="document.get('documentType').value"
                    [uploadStatus]="uploadingDoc === 'front-' + i"
                  >
                  </hospitality-bot-upload-file>
                  <p class="text">
                    {{ document.get('settings').value['frontImageName'] }}
                  </p>
                </div>
                <div
                  class="upload-image"
                  *ngIf="
                    document.get('settings').value['backImage'] !==
                    'not-required'
                  "
                >
                  <hospitality-bot-upload-file
                    [fileUploadData]="fileUploadData"
                    [url]="document.get('backUrl').value"
                    [pageType]="'back'"
                    (fileData)="uploadDocuments($event, 'back', i)"
                    [documentType]="document.get('documentType').value"
                    [uploadStatus]="uploadingDoc === 'back-' + i"
                  >
                  </hospitality-bot-upload-file>
                  <p class="text">
                    {{ document.get('settings').value['backImageName'] }}
                  </p>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <hr class="data-seperator" />
        <mat-label class="mat-head">Documents Status</mat-label>
        <div class="pending-button-wrapper">
          <p class="health-status ml-0">
            Document Verification Status :&nbsp;<b class="pending">{{
              selectedGuestGroup.get('status').value
            }}</b>
          </p>
          <div
            *ngIf="
              ['CHECKIN'].includes(detailsData.currentJourneyDetails.journey)
            "
          >
            <!-- He can only take action and write remarks if its a checkin day only.-->
            <div class="decision-button-wrapper">
              <ng-container
                *ngIf="
                  ['INITIATED', 'FAILED'].includes(
                    selectedGuestGroup.get('status').value
                  )
                "
              >
                <!-- No action button in case of pending and completed stage -->
                <button
                  class="right"
                  (click)="updateDocumentVerificationStatus('ACCEPT')"
                >
                  <img src="assets/svg/tick.svg" />
                </button>
                <button
                  class="right"
                  (click)="updateDocumentVerificationStatus('REJECT')"
                >
                  <img src="assets/svg/cross.svg" />
                </button>
              </ng-container>
            </div>
          </div>
        </div>
        <div
          *ngIf="
            ['CHECKIN', 'CHECKOUT'].includes(
              detailsData.currentJourneyDetails.journey
            ) &&
            ['INITIATED', 'COMPLETED', 'FAILED'].includes(
              selectedGuestGroup.get('status').value
            )
          "
          class="remark-wrapper"
        >
          <!-- Add flow not to show  remarks when its empty and status is completed -->
          <div class="text">Remarks :</div>
          <div class="remark">
            <hospitality-bot-custom-size-input
              [parentForm]="selectedGuestGroup"
              [name]="'remarks'"
              [customSize]="200"
            ></hospitality-bot-custom-size-input>
          </div>
        </div>
      </form>
    </ng-container>
  </div>
</div>

<ng-template #emptyDoc>
  <div class="empty-view">
    <div class="wrapper">
      <img src="assets/images/Documents.png" alt="documents" />
      <p class="label">Documents Pending!</p>
      <p
        class="note"
        *ngIf="
          documentStatus.get('status').value === 'PENDING';
          else nationalityChangedText
        "
      >
        Seems like guest has not initiated Precheckin.
      </p>
      <ng-template #nationalityChangedText>
        <p class="note">
          Seem like you have documents is still not submitted.
        </p></ng-template
      >

      <p class="note">Select document type to upload documents.</p>
    </div>
  </div>
</ng-template>
