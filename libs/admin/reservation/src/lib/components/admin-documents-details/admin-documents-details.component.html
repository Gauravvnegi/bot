<div class="material-body">
  <div
    *ngIf="
      detailsData.stepStatusDetails.documents !== 'PENDING';
      else documentsPending
    "
  >
    <!-- Check if documents pending in any case ; then show pending template. If documents are initiated, completed or failed i can view docs-->
    <div class="document-header">
      <div class="heading">
        <p class="label">Guest Documents</p>
        <ng-container [ngSwitch]="documentStatus.get('status').value">
          <img
            *ngSwitchCase="'COMPLETED'"
            src="assets/svg/status/success.svg"
          />

          <img *ngSwitchCase="'FAILED'" src="assets/svg/status/fail.svg" />

          <img *ngSwitchCase="'PENDING'" src="assets/svg/status/pending.svg" />

          <img
            *ngSwitchCase="'INITIATED'"
            src="assets/svg/status/initiated.svg"
          />
        </ng-container>
      </div>

      <div
        class="download"
        *ngIf="selectedGuestGroup"
        (click)="downloadDocs(selectedGuestGroup.get('documents').value)"
      >
        <img src="assets/svg/d_document.svg" alt="document" /> &nbsp;
        <p>Download All Docs</p>
      </div>
    </div>
    <ng-container *ngIf="selectedGuestGroup">
      <form [formGroup]="selectedGuestGroup">
        <div class="wrapper">
          <div class="document-name-nationality">
            <mat-form-field class="nationality">
              <mat-select
                [(value)]="selectedGuestId"
                (selectionChange)="onGuestChange($event.value)"
              >
                <mat-option
                  *ngFor="let guest of detailsData.guestDetails.guests"
                  [value]="guest.id"
                >
                  {{ guest.title }} {{ guest.firstName }} {{ guest.lastName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <div class="nationality-wrapper">
              <span class="text">Nationality :</span>
              <mat-form-field *ngIf="selectedGuestGroup">
                <mat-select
                  [(value)]="selectedGuestGroup.get('nationality').value"
                  formControlName="nationality"
                  [disabled]="true"
                  (selectionChange)="onNationalityChange($event.value)"
                >
                  <mat-option
                    *ngFor="let country of countriesLOV"
                    [value]="country.value"
                  >
                    {{ country.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="nationality-wrapper"></div>
          <div *ngIf="selectedGuestGroup.get('nationality').value">
            <ng-container
              formArrayName="documents"
              *ngFor="
                let document of selectedGuestGroup.get('documents').controls;
                let i = index
              "
            >
              <div class="upload-image-wrapper" [formGroupName]="i">
                <div class="upload-image">
                  <hospitality-bot-upload-file
                    [fileUploadData]="fileUploadData"
                    [url]="document.get('frontUrl').value"
                    [pageType]="'front'"
                    [documentType]="document.get('documentType').value"
                  >
                  </hospitality-bot-upload-file>
                  <p class="text">
                    {{ document.get('documentType').value
                    }}{{
                      document.get('documentType').value !== 'VISA'
                        ? ' FRONT'
                        : ''
                    }}
                    PAGE<b class="red-color">*</b>
                  </p>
                </div>
                <div class="upload-image" *ngIf="document.get('backUrl').value">
                  <hospitality-bot-upload-file
                    [fileUploadData]="fileUploadData"
                    [url]="document.get('backUrl').value"
                    [pageType]="'back'"
                    [documentType]="document.get('documentType').value"
                  >
                  </hospitality-bot-upload-file>
                  <p class="text">
                    {{ document.get('documentType').value }} BACK PAGE<b
                      class="red-color"
                      >*</b
                    >
                  </p>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <hr class="data-seperator" />
        <mat-label class="mat-head">Documents Status</mat-label>
        <div class="pending-button-wrapper">
          <p class="health-status ml-0">
            Document Verification Status :&nbsp;<b class="pending">{{
              selectedGuestGroup.get('status').value
            }}</b>
          </p>
          <div
            *ngIf="
              ['CHECKIN'].includes(detailsData.currentJourneyDetails.journey)
            "
          >
            <!-- He can only take action and write remarks if its a checkin day only.-->
            <div class="decision-button-wrapper">
              <ng-container
                *ngIf="
                  ['INITIATED', 'FAILED'].includes(
                    selectedGuestGroup.get('status').value
                  )
                "
              >
                <!-- No action button in case of pending and completed stage -->
                <button
                  class="right"
                  (click)="updateDocumentVerificationStatus('ACCEPT')"
                >
                  <img src="assets/svg/tick.svg" />
                </button>
                <button
                  class="right"
                  (click)="updateDocumentVerificationStatus('REJECT')"
                >
                  <img src="assets/svg/cross.svg" />
                </button>
              </ng-container>
            </div>
          </div>
        </div>
        <div
          *ngIf="
            ['CHECKIN', 'CHECKOUT'].includes(
              detailsData.currentJourneyDetails.journey
            ) &&
            ['INITIATED', 'COMPLETED', 'FAILED'].includes(
              selectedGuestGroup.get('status').value
            )
          "
          class="remark-wrapper"
        >
          <!-- Add flow not to show  remarks when its empty and status is completed -->
          <form [formGroup]="selectedGuestGroup">
            <span class="text">Remark :</span>
            <mat-form-field class="remark">
              <input matInput formControlName="remarks" />
            </mat-form-field>
          </form>
        </div>
      </form>
    </ng-container>
  </div>
  <ng-template #documentsPending>
    <div class="empty-view">
      <div class="wrapper">
        <img src="assets/images/Documents.png" />
        <p class="label">Documents Pending!</p>
        <p class="note">Seems like guest has not initiated Precheckin.</p>
      </div>
    </div>
  </ng-template>
</div>
