<div class="wrapper">
  <hospitality-bot-navigation-header
    [heading]="pageTitle"
    [routes]="navRoutes"
  ></hospitality-bot-navigation-header>
  <form [formGroup]="useForm">
    <div class="room-info-wrapper">
      <div class="header">Room Information</div>
      <hr />
      <div class="room-info-form-wrapper">
        <div class="room-type-name">
          <hospitality-bot-input
            controlName="name"
            label="Room Type Name"
            maxLength="60"
          ></hospitality-bot-input>
        </div>
        <div class="file-upload-wrapper">
          <hospitality-bot-custom-file-upload
            formControlName="imageUrls"
            label="Image"
            description="Mandatory to add at least 1 image"
            [settings]="{
              limit: 1,
              unit: 4
            }"
            [hotelId]="hotelId"
            path="static-content/room-types"
          ></hospitality-bot-custom-file-upload>
        </div>
        <div class="room-des">
          <p>Room Description</p>
          <hospitality-bot-template-editor
            [parentFG]="useForm"
            [name]="'description'"
            [height]="250"
          ></hospitality-bot-template-editor>
        </div>
      </div>
    </div>

    <div class="room-details-wrapper" *ngIf="roomTypeId">
      <hospitality-bot-room-details-data-table></hospitality-bot-room-details-data-table>
    </div>

    <div class="room-pricing-wrapper">
      <div class="header">Services</div>
      <hr />
      <div class="room-services-wrapper">
        <hospitality-bot-custom-select
          label="Complimentary Services"
          description="This is a free of cost services"
          formControlName="complimentaryAmenities"
          [itemList]="compServices"
          (viewAll)="saveRoomTypeData('COMPLIMENTARY')"
          [noRecordsAction]="noRecordAction"
          [loading]="loading"
        ></hospitality-bot-custom-select>
        <div class="paid-services">
          <hospitality-bot-custom-select
            label="Paid Services"
            description="Do not forget to add this cost in addition to the room cost"
            formControlName="paidAmenities"
            [itemList]="paidServices"
            (viewAll)="saveRoomTypeData('PAID')"
            [noRecordsAction]="noRecordAction"
            [loading]="loading"
          ></hospitality-bot-custom-select>
        </div>
      </div>
    </div>
    <!-- <div class="room-pricing-wrapper">
      <div class="header">Room Pricing</div>
      <hr />
      <div class="room-pricing-form-wrapper">
        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="currency"
            postControlName="minPrice"
            label="Min Price"
            [options]="currencies"
            [props]="inputValidationProps"
            [defaultProps]="{ post: { type: 'number' } }"
          ></hospitality-bot-prefix-field>
        </div>
        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="currency"
            postControlName="maxPrice"
            label="Max Price"
            [options]="currencies"
            [props]="inputValidationProps"
            [defaultProps]="{ post: { type: 'number' } }"
          ></hospitality-bot-prefix-field>
        </div>
        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="currency"
            postControlName="paxAdditionalCost"
            label="Pax Additional Cost"
            [options]="currencies"
            [props]="inputValidationProps"
            [defaultProps]="{ post: { type: 'number' } }"
          ></hospitality-bot-prefix-field>
        </div>

        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="variablePriceCurrency"
            postControlName="variableAmount"
            label="Variable Price"
            [options]="currencies"
            [props]="{ errorMessages: inputValidationProps.errorMessages }"
            [defaultProps]="{
              post: {
                type: 'number',
                additionalInfo: 'Price per additional adult'
              }
            }"
          ></hospitality-bot-prefix-field>
        </div>
        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="discountType"
            postControlName="discountValue"
            label="Discount Type"
            [options]="discountTypes"
            [props]="inputValidationProps"
            [defaultProps]="{ post: { type: 'number' } }"
          ></hospitality-bot-prefix-field>
        </div>
        <div class="input-fields">
          <hospitality-bot-prefix-field
            preControlName="discountedPriceCurrency"
            postControlName="discountedPrice"
            label="Discounted Price"
            [options]="currencies"
            [defaultProps]="{ post: { type: 'number' } }"
          ></hospitality-bot-prefix-field>
        </div>
      </div>
    </div> -->
    <div class="room-pricing-wrapper" formArrayName="ratePlan">
      <div class="header">Room Pricing</div>
      <hr />
      <div class="room-pricing-form-wrapper">
        <p-accordion [multiple]="true">
          <p-accordionTab
            *ngFor="let ratePlanGroup of ratePlanArray.controls; let i = index"
            click
            [ngStyle]="{
              'border-bottom': ratePlanGroup.expanded
                ? '1px solid rgba(112, 112, 112, 0.35)'
                : 'none'
            }"
          >
            <p-header>
              <div class="header-wrapper">
                <div
                  class="header-button"
                  (click)="
                    menu.toggle($event);
                    selectedIndex = i;
                    $event.stopPropagation()
                  "
                >
                  <span> {{ ratePlanGroup.get('type').value }}</span>
                  <i class="pi pi-angle-down"></i>
                </div>
                <p-menu
                  #menu
                  [popup]="true"
                  [model]="plans"
                  styleClass="custom-menu"
                  click-stop-propagation
                >
                  <ng-template let-option pTemplate="item">
                    <span [ngClass]="{ 'disabled-option': option.disabled }">{{
                      option.label
                    }}</span>
                  </ng-template>
                </p-menu>
              </div>
              <hospitality-bot-button
                label="Remove"
                variant="text"
                severity="reset"
                (onClick)="onRemove(ratePlanGroup.get('type').value, i)"
                [disabled]="ratePlanArray.length === 1"
              ></hospitality-bot-button>
            </p-header>

            <div class="form-block" [formGroupName]="i">
              <hospitality-bot-prefix-field
                class="half-width"
                preControlName="basePriceCurrency"
                postControlName="basePrice"
                label="Base Price-Single Occupancy"
                [options]="currencies"
                [defaultProps]="{
                  post: { type: 'number' }
                }"
                ></hospitality-bot-prefix-field>
                <!-- errorMessages: inputValidationProps.errorMessages, -->
              <hospitality-bot-prefix-field
                class="half-width"
                preControlName="discountType"
                postControlName="discountValue"
                label="Discount Type"
                [options]="discountTypes"
                [defaultProps]="{
                  post: { type: 'number' }
                }"
                ></hospitality-bot-prefix-field>
                <!-- errorMessages: inputValidationProps.errorMessages, -->
              <hospitality-bot-prefix-field
                class="half-width"
                preControlName="bestRateCurrency"
                postControlName="bestAvailableRate"
                label="Best Available Rate"
                [options]="currencies"
                [defaultProps]="{
                  post: { type: 'number' }
                }"
                ></hospitality-bot-prefix-field>
                <!-- errorMessages: inputValidationProps.errorMessages, -->
              <hospitality-bot-prefix-field
                class="half-width"
                preControlName="paxAdditionalCostCurrency"
                postControlName="paxAdditionalCost"
                label="Pax Additional Cost"
                [options]="currencies"
                [defaultProps]="{
                  post: { type: 'number' }
                }"
                ></hospitality-bot-prefix-field>
                <!-- errorMessages: inputValidationProps.errorMessages, -->
            </div>
          </p-accordionTab>
        </p-accordion>
        <div class="rate-plan-btn">
          <hospitality-bot-button
            label="+ Add Rate Plan"
            (onClick)="addNewRatePlan()"
            variant="text"
            [disabled]="planCount >= plans.length"
          ></hospitality-bot-button>
        </div>
      </div>
    </div>

    <div class="room-pricing-wrapper">
      <div class="header">Room Occupancy</div>
      <hr />
      <div class="room-pricing-form-wrapper">
        <div class="input-fields">
          <hospitality-bot-input
            controlName="maxOccupancy"
            label="Max Occupancy"
            [props]="{
              errorMessages: {
                required: 'This is a required field.',
                min: 'Value must be greater than 0.',
                notAllowedChr: 'Decimal are not allowed.'
              },
              type: 'number'
            }"
          ></hospitality-bot-input>
        </div>
        <div class="input-fields">
          <hospitality-bot-input
            controlName="maxChildren"
            label="Max Children"
            [props]="inputValidationProps"
          ></hospitality-bot-input>
        </div>
        <div class="input-fields">
          <hospitality-bot-input
            controlName="maxAdult"
            label="Max Adult"
            [props]="inputValidationProps"
          ></hospitality-bot-input>
        </div>
        <div class="input-fields">
          <hospitality-bot-input
            controlName="area"
            label="Room Area"
            [props]="{
              errorMessages: inputValidationProps.errorMessages,
              type: 'number',
              subtitle: 'Sq. Ft'
            }"
          ></hospitality-bot-input>
        </div>
      </div>
    </div>
  </form>
  <div class="footer-buttons">
    <hospitality-bot-button
      label="Reset All"
      (onClick)="resetForm()"
      variant="outlined"
      severity="reset"
    ></hospitality-bot-button>
    <hospitality-bot-button
      [label]="roomTypeId ? 'Update' : 'Create'"
      (onClick)="submitForm()"
      [isLoading]="loading"
    ></hospitality-bot-button>
  </div>
</div>
