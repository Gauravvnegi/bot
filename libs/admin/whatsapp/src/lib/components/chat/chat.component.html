<div class="chat-height">
  <div class="guestInfoOpen">
    <div class="guestInfoOpen-guest-wrap">
      <div
        class="guestInfoAvatar"
        [style.background]="
          selectedChat?.mute ? '#d9d9d9' : selectedChat?.color
        "
      >
        <img
          [src]="chat?.receiver?.profileUrl"
          *ngIf="chat?.receiver?.profileUrl"
        />
        <div
          class="guestInfoAvatar_nickName"
          *ngIf="
            selectedChat?.getProfileNickName() && !selectedChat?.mute;
            else defaultOrMute
          "
        >
          {{ selectedChat?.getProfileNickName() }}
        </div>
        <ng-template #defaultOrMute>
          <ng-container
            *ngTemplateOutlet="selectedChat?.mute ? muteAvatar : defaultAvatar"
          ></ng-container>
        </ng-template>

        <ng-template #defaultAvatar>
          <img
            src="assets/svg/defaultUser.svg"
            alt="default"
            class="guestInfoAvatar_default"
          />
        </ng-template>

        <ng-template #muteAvatar>
          <img class="mute-avatar" src="assets/images/mute.svg" alt="default" />
        </ng-template>
      </div>
      <div class="selectedChat">
        <div guest-details-sidebar [guestId]="selectedChat?.guestId">
          {{ selectedChat ? selectedChat?.name || selectedChat?.phone : '' }}
        </div>
      </div>
    </div>

    <div class="mr-10" [formGroup]="liveChatFG">
      <div class="req_button">
        <i
          class="pi pi-refresh refresh"
          (click)="refreshChat()"
          [ngClass]="{ 'pi-spin': isLoading }"
          pTooltip="Refresh Chat"
          tooltipPosition="bottom"
        ></i>

        <div class="export-chat" (click)="exportChat()">
          <img src="assets/svg/documentColor.svg" alt="csv" />
          <div>Export Chat</div>
        </div>
        <div class="guestInfoEditWrapper">
          <div
            class="guestInfoEditContainer"
            *ngIf="
              buttonConfig[selectedIndex].button && isComplaintTrackerSubscribed
            "
            (click)="handleButtonClick()"
          >
            <img [src]="buttonConfig[selectedIndex].icon" alt="" />
            <div class="guestInfoEditText">
              {{ buttonConfig[selectedIndex].label }}
            </div>
          </div>
        </div>
        <!-- <mat-slide-toggle
          featureSubscribed
          [feature]="productName.whatsappBot"
          formControlName="status"
          (change)="onLiveChatChange()"
          [disabled]="liveChatStatus.value"
          >Hand Over to Bot</mat-slide-toggle
          > -->
        <ng-container *ngIf="!liveChatStatus.value && loadingChat">
          <img
            class="end-chat"
            [src]="'assets/svg/end-chat.svg'"
            alt="Exit Chat"
            [pTooltip]="'Exit Live Chat'"
            tooltipPosition="bottom"
            (click)="openEndLiveChatPopup()"
          />
        </ng-container>
        <!-- <img
          *ngIf="!guestInfoEnable"
          class="icon"
          src="assets/svg/hamBurger.svg"
          [alt]=""
          (click)="openGuestInfo()"
        /> -->
      </div>
    </div>
  </div>
  <div
    class="scrollChat"
    *ngIf="chatDates.length; else noChat"
    [ngStyle]="
      chatFG && chatList.receiver[selectedChat.receiverId]?.checkEnableSend()
        ? { height: 'calc(100% - 125px)' }
        : { height: 'calc(100% - 124px)' }
    "
    #scrollMe
    infiniteScroll
    (scrolled)="loadMore()"
    [toggleScrollListener]="paginationDisabled"
    [scrollSettings]="{ reverse: true }"
  >
    <ng-container *ngFor="let date of chatDates">
      <div class="chatDate">
        {{ date }}
      </div>
      <div
        *ngFor="let message of chatList.messages[selectedChat.receiverId][date]"
        class="d-flex"
        [ngStyle]="
          message.direction === 'OUTBOUND'
            ? { 'justify-content': 'flex-end' }
            : {}
        "
      >
        <div
          [ngClass]="
            message.direction === 'OUTBOUND' ? 'right-message' : 'left-message'
          "
          [ngStyle]="
            message.status === 'sent' ? { opacity: '1' } : { opacity: '0.5' }
          "
        >
          <div
            [ngClass]="
              message.direction === 'OUTBOUND'
                ? 'right-message__text'
                : 'left-message__text'
            "
          >
            <ng-container *ngIf="message.text; else media">
              <p
                [innerHTML]="message.text | linkDetector"
                class="messageText"
              ></p>
            </ng-container>
            <ng-template #media>
              <hospitality-bot-media-chat
                [message]="message"
              ></hospitality-bot-media-chat
            ></ng-template>
          </div>
          <div class="message__time">
            {{ message.getTime(globalFilterService.timezone) }}
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <ng-template #noChat>
    <div class="noChat"></div>
  </ng-template>
  <ng-container *ngIf="this.chatList.receiver[selectedChat.receiverId]">
    <hospitality-bot-message-box
      [chatFG]="chatFG"
      [selectedChat]="selectedChat"
      [chatList]="chatList"
      [entityId]="entityId"
      (messageSent)="handleSentMessage($event)"
    ></hospitality-bot-message-box>
  </ng-container>
</div>

<!-- <p-sidebar
  class="sidebar-slide"
  [ngClass]="sidebarType"
  [(visible)]="sidebarVisible"
  position="right"
  [showCloseIcon]="false"
>
  <ng-container #sidebarSlide></ng-container>
</p-sidebar> -->
