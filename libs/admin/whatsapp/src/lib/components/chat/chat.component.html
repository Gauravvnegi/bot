<div class="chat-height">
  <div class="guestInfoOpen">
    <div style="display: flex; align-items: center;" (click)="openGuestInfo()">
      <div class="guestInfoAvatar" [style.background]="selectedChat?.color">
        <img
          [src]="chat?.receiver?.profileUrl"
          *ngIf="chat?.receiver?.profileUrl; else defaultAvatar"
        />
        <ng-template #defaultAvatar
          ><div class="label">
            {{ selectedChat?.getProfileNickName() }}
          </div></ng-template
        >
      </div>
      <div class="selectedChat">
        {{ selectedChat ? selectedChat?.name || selectedChat?.phone : '' }}
      </div>
    </div>
    <div style="margin-right: 10px;" [formGroup]="liveChatFG">
      <mat-slide-toggle formControlName="status" (change)="onLiveChatChange()"
        >Live Chat</mat-slide-toggle
      >
    </div>
  </div>
  <div
    class="scrollChat"
    (scroll)="onScroll($event)"
    *ngIf="chatDates.length; else noChat"
    #scrollMe
  >
    <ng-container *ngFor="let date of chatDates">
      <div class="chatDate">
        {{ date }}
      </div>
      <div
        *ngFor="let message of chatList.messages[selectedChat.receiverId][date]"
        class="d-flex"
        [ngStyle]="
          message.direction === 'OUTBOUND'
            ? { 'justify-content': 'flex-end' }
            : {}
        "
      >
        <div
          [ngClass]="
            message.direction === 'OUTBOUND' ? 'right-message' : 'left-message'
          "
          [ngStyle]="
            message.status === 'sent' ? { opacity: '1' } : { opacity: '0.5' }
          "
        >
          <div
            [ngClass]="
              message.direction === 'OUTBOUND'
                ? 'right-message__text'
                : 'left-message__text'
            "
          >
            <ng-container *ngIf="message.text; else media">
              <p [innerHTML]="message.text | linkDetector"></p>
            </ng-container>
            <ng-template #media>
              <hospitality-bot-media-chat
                [message]="message"
              ></hospitality-bot-media-chat
            ></ng-template>
          </div>
          <div class="message__time">
            {{ message.getTime(_globalFilterService.timezone) }}
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <ng-template #noChat>
    <div class="noChat"></div>
  </ng-template>
  <ng-container *ngIf="this.chatList.receiver[selectedChat.receiverId]">
    <hospitality-bot-message-box
      [chatFG]="chatFG"
      [selectedChat]="selectedChat"
      [chatList]="chatList"
      [hotelId]="hotelId"
      (messageSent)="handleSentMessage($event)"
    ></hospitality-bot-message-box>
  </ng-container>
</div>
