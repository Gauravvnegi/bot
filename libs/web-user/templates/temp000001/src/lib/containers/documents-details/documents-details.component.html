<div class="container">
  <form [formGroup]="guestsFA">
    <ng-container
      *ngFor="
        let guestGroup of guestsFA['controls'];
        let guestGroupIndex = index
      "
    >
      <mat-accordion #accordian="matAccordion" [multi]="true">
        <mat-expansion-panel #panel [expanded]="0 === guestGroupIndex">
          <mat-expansion-panel-header>
            <mat-panel-title class="container__title">
              {{ guestGroup.get('label').value }}
              <mat-icon class="expand-icon" *ngIf="!panel.expanded"
                >add</mat-icon
              >
              <mat-icon class="expand-icon" *ngIf="panel.expanded"
                >remove</mat-icon
              >
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="citizen__info">
            <div class="citizen__info--country">
              <web-user-select-box
                [parentForm]="guestGroup"
                [name]="'nationality'"
                [index]="guestGroupIndex"
                [settings]="
                  guestDetailsConfig &&
                  guestDetailsConfig[guestGroup.get('id').value] &&
                  guestDetailsConfig[guestGroup.get('id').value].nationality
                "
                (optionChange)="
                  onNationalityChange($event, guestGroup.get('id').value)
                "
              >
              </web-user-select-box>
            </div>
            <div class="citizen__info--doc">
              <web-user-select-box
                [parentForm]="guestGroup"
                [name]="'selectedDocumentType'"
                [index]="guestGroupIndex"
                [settings]="
                  guestDetailsConfig &&
                  guestDetailsConfig[guestGroup.get('id').value] &&
                  guestDetailsConfig[guestGroup.get('id').value]
                    .selectedDocumentType
                "
                (optionChange)="
                  onSelectedDocumentTypeChange(
                    $event,
                    guestGroup.get('id').value
                  )
                "
              >
              </web-user-select-box>
            </div>
          </div>
          <div class="doc__upload__section">
            <ng-container
              *ngFor="
                let documentFG of guestGroup.get('documents')['controls'];
                let documentFGIndex = index
              "
            >
              <ng-container>
                <div class="doc__upload__section--doc extra-gap">
                  <web-user-file-upload
                    [parentForm]="documentFG"
                    [fileSize]="maxFileSize"
                    [fileType]="validFileType"
                    [name]="'documentFileFront'"
                    [index]="documentFGIndex"
                    [url]="documentFG.get('documentFileFront').value"
                    [settings]="
                      guestDetailsConfig &&
                      guestDetailsConfig[guestGroup.get('id').value]
                        .documents &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ] &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileFront
                    "
                    [isUploading]="
                      guestDetailsConfig &&
                      guestDetailsConfig[guestGroup.get('id').value]
                        .documents &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ] &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileFront &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileFront.isUploading
                    "
                    (documentData)="
                      saveDocument($event, {
                        guestId: guestGroup.get('id').value,
                        doc_page: 'front',
                        doc_type: documentFG.get('documentType').value,
                        doc_issue_place: guestGroup.get('nationality').value
                      })
                    "
                  ></web-user-file-upload>
                </div>
                <div
                  *ngIf="
                    guestGroup.get('selectedDocumentType').value ||
                    documentFG.get('documentType').value !== 'VISA'
                  "
                  class="doc__upload__section--doc extra-gap"
                >
                  <web-user-file-upload
                    [parentForm]="documentFG"
                    [fileSize]="maxFileSize"
                    [fileType]="validFileType"
                    [name]="'documentFileBack'"
                    [index]="documentFGIndex"
                    [url]="documentFG.get('documentFileBack').value"
                    [settings]="
                      guestDetailsConfig &&
                      guestDetailsConfig[guestGroup.get('id').value]
                        .documents &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ] &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileBack
                    "
                    [isUploading]="
                      guestDetailsConfig &&
                      guestDetailsConfig[guestGroup.get('id').value]
                        .documents &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ] &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileBack &&
                      guestDetailsConfig[guestGroup.get('id').value].documents[
                        documentFGIndex
                      ].documentFileBack.isUploading
                    "
                    (documentData)="
                      saveDocument($event, {
                        guestId: guestGroup.get('id').value,
                        doc_page: 'back',
                        doc_type: documentFG.get('documentType').value,
                        doc_issue_place: guestGroup.get('nationality').value
                      })
                    "
                  ></web-user-file-upload>
                </div>
              </ng-container>
            </ng-container>
          </div>
          <div
            class="doc__warning_section"
            fxLayout
            fxLayoutGap="70px"
            fxLayoutAlign="center"
          >
            <div
              class="hide_on_mobile"
              *ngIf="
                guestGroup.get('documents')['controls'] &&
                guestGroup.get('documents')['controls'].length
              "
            >
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Upload Complete</span>
              </p>
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Clearly Visible</span>
              </p>
            </div>
            <div
              class="hide_on_mobile"
              *ngIf="
                guestGroup.get('documents')['controls'] &&
                guestGroup.get('documents')['controls'].length
              "
            >
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Document in Valid Period</span>
              </p>
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>No larger than 3 MB in size</span>
              </p>
            </div>
            <div
              class="show_on_mobile"
              *ngIf="
                guestGroup.get('documents')['controls'] &&
                guestGroup.get('documents')['controls'].length
              "
            >
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Upload Complete</span>
              </p>
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Clearly Visible</span>
              </p>
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>Document in Valid Period</span>
              </p>
              <p>
                <mat-icon matSuffix>error_outline</mat-icon>
                <span>No larger than 3 MB in size</span>
              </p>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </ng-container>
  </form>
</div>
